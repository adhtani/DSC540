(window.webpackJsonp=window.webpackJsonp||[]).push([[341],{"4QoS":function(t,e,n){"use strict";n.r(e),n.d(e,"takeChartSnapshot",(function(){return a})),n.d(e,"makeSnapshotRequest",(function(){return c}));var r=n("mrSG"),o=(n("HbRj"),n("YFKU"),n("Kxc7")),i=n("Gvuy"),s=n("BHQF");function a(t,e,n,o){var i;return void 0===o&&(o={}),Object(r.b)(this,void 0,void 0,(function(){var s,a,u,l,d,g,p,f;return Object(r.d)(this,(function(r){if(s=new FormData,void 0!==o.previews)for(a=0,u=o.previews;a<u.length;a++)l=u[a],s.append("previews[]",l);return void 0!==o.cme&&s.append("cme",String(o.cme)),void 0!==o.wl&&s.append("wl",String(o.wl)),void 0!==o.onWidget&&s.append("onWidget",String(o.onWidget)),o.isReport&&s.append("isReport",String(o.isReport)),(d=window.urlParams)&&d.locale&&s.append("language",d.locale),g=t.activeChartWidget.value(),void 0!==(p=g.widgetCustomer())&&s.append("customer",p),"exchange"===(f=g.properties().childs().timezone.value())&&(f=(null===(i=g.model().mainSeries().symbolInfo())||void 0===i?void 0:i.timezone)||f),s.append("timezone",f),s.append("images",JSON.stringify(t.images())),c(s,e,n,o),[2]}))}))}function c(t,e,a,c){return void 0===c&&(c={}),Object(r.b)(this,void 0,void 0,(function(){var u,l,d,g;return Object(r.d)(this,(function(r){switch(r.label){case 0:u=o.enabled("charting_library_base")?c.snapshotUrl||"https://www.tradingview.com/snapshot/":"/snapshot/",r.label=1;case 1:return r.trys.push([1,4,,5]),[4,Object(s.fetch)(u,{body:t,method:"POST",credentials:"same-origin"})];case 2:return[4,(l=r.sent()).text()];case 3:if(d=r.sent(),l.ok)e(d);else{if("suspicious_chart_snapshots_error"===d)return g=window.t("Snapshot seems to contain prohibited content. Please contact {start_link}our support team{end_link} if you have received this by mistake.").format({start_link:'<a class="tv-dialog__link js-send-report-link" href="#" data-issue-type="other">',end_link:"</a>"}),c.onInvalidSnapshotImage&&c.onInvalidSnapshotImage(),[2,Object(i.createErrorDialog)({title:window.t("Your snapshot was flagged as suspicious"),content:g,btnType:"danger"}).then((function(t){t.on("afterOpen",(function(){n.e("bug-dialog-creation-handler").then(function(e){(0,n("k2ji").bugDialogCreationHandler)(),t.$el.find(".js-send-report-link").click((function(){t.close()}))}.bind(null,n)).catch(void 0)})),t.open()}))];a()}return[3,5];case 4:return r.sent(),a(),[3,5];case 5:return[2]}}))}))}},ZOL7:function(t,e,n){"use strict";n.r(e);var r=n("mrSG"),o=(n("bSeV"),n("Kxc7")),i=n("jHdF"),s=n.n(i),a=n("4QoS"),c=n("N22A"),u=n("mNbo"),l=n("qFKp"),d=n("iQNB"),g=n("txPx"),p=(n("NNtz"),n("TxTq")),f=n.n(p),h=n("Vdly"),v=n.n(h);function _(t){return{name:t.name,time:t.startTime}}var w=n("KuNA");n.d(e,"SupportTicketData",(function(){return b}));var m=Object(g.getLogger)("Support.TicketData"),b=function(){function t(t){void 0===t&&(t={}),this._options=t,this.reset()}return t.prototype.destroy=function(){delete this._data,delete this._browserInfo,delete this._dialogElement},t.prototype.reset=function(){this._data={event:"support_ticket"},this._browserInfo=new s.a
},t.prototype.setOptions=function(t){this._options=Object(r.a)(Object(r.a)({},this._options),t)},t.prototype.getData=function(){return this._data},t.prototype.addData=function(t){Object.assign(this._data,t)},t.prototype.setDialogElement=function(t){this._dialogElement=t},t.prototype.getFinalData=function(){return Object(r.b)(this,void 0,void 0,(function(){var t,e;return Object(r.d)(this,(function(n){switch(n.label){case 0:return void 0===this._beforeCollectingFinalData?[3,2]:[4,this._beforeCollectingFinalData()];case 1:n.sent(),n.label=2;case 2:return this._options.disableAutoCollection?(e=this.getData(),[3,5]):[3,3];case 3:return[4,this._collectData()];case 4:e=n.sent(),n.label=5;case 5:return t=e,Object(d.i)(t)?[2,t]:(m.logError("Not enough data collected. `event` and one of (`userId`, `email`) fields required."),[2,null])}}))}))},t.prototype.onBeforeCollectingFinalData=function(t){this._beforeCollectingFinalData=t},t.setChartWidgetCollection=function(e){t._chartWidgetCollection=e},t.getChartWidgetCollection=function(){return t._chartWidgetCollection},t.setScreener=function(e){t._screener=e},t.getScreener=function(){return t._screener},t.prototype._collectData=function(){var t=this,e=Promise.all([this._getBrowserInfo(),this._getChartSnapshot(),this._getTradingLogs(),this._getScreenerParams(),this._getPageSnapshot(),this._getLogHistory()]).then((function(e){t.addData(t._filterEmptyFields({browserInfo:e[0],snapshotURL:e[1],trading:e[2],screener:e[3],pageSnapshotURL:e[4],log:e[5]}))})).then((function(){return t._data}));return this.addData(this._filterEmptyFields({ping:this._getPingInfo(),user:this._getUser(),userId:this._getUserId(),pro_plan:this._getProPlan(),websocketAddress:this._getWebSocketAddress(),sessionid:this._getSessionId(),ref:this._getReferrer(),js_errors:this._getJsErrors(),product:this._getProductId(),extendedHours:this._getExtendedHours(),dividendsAdjustment:this._getDividendsAdjustment(),chartSessionDisconnects:this._getChartSessionDisconnects(),marketStatuses:this._getChartMarketStatuses(),seriesStatuses:this._getChartSeriesStatuses(),is_pro:this._getUserIsPro(),subscription_state:this._getSubscriptionState(),proOffers:this._getProOffers(),timezone:this._getTimezone(),performanceMetrics:this._getPerformanceMetrics(),serverInfo:this._getServerInfo(),serverTimeOffset:this._getServerTimeOffset(),settings:this._getUserSettings(),domNodesCount:this._getDomNodesCount(),buildTime:this._getBuildTime(),plugins:this._getPlugins()})),e},t.prototype._getBrowserInfo=function(){var t=this;return new Promise((function(e){t._browserInfo.ready().then((function(){e(t._browserInfo.state())}))}))},t.prototype._getChartSnapshot=function(){var e=this;return new Promise((function(n){return Object(r.b)(e,void 0,void 0,(function(){var e,i,s;return Object(r.d)(this,(function(r){switch(r.label){case 0:if(void 0===(e=t.getChartWidgetCollection()))return m.logWarn("Abort generating snapshot. No chartWidgetCollection found."),n(null),[2];i=o.enabled("snapshot_trading_drawings"),r.label=1;case 1:return r.trys.push([1,3,4,5]),
o.enable("snapshot_trading_drawings"),[4,Object(a.takeChartSnapshot)(e,(function(t){var e=o.enabled("charting_library_base")?"https://www.tradingview.com/x/"+t:location.protocol+"//"+location.host+"/x/"+t;n(e)}),(function(){m.logError("Failed to take chart snapshot."),n(null)}))];case 2:return r.sent(),[3,5];case 3:return s=r.sent(),m.logError("Error while taking chart snapshot: "+s.message),n(null),[2];case 4:return i?o.enable("snapshot_trading_drawings"):o.disable("snapshot_trading_drawings"),[7];case 5:return[2]}}))}))}))},t.prototype._getTradingLogs=function(){var t=this;return new Promise((function(e){if(!t._data.tradingLogsAgree)return m.logWarn("Abort collecting trading logs. User did not agree to send trading logs."),void e(null);var n=Object(c.tradingService)();if(!n)return m.logWarn("Abort collecting trading logs. No trading object found."),void e(null);var r=n.activeBroker();if(null===r||!r.bugReportInfo||1!==r.connectionStatus())return m.logWarn("Abort collecting trading logs because of connection or abscence of info collection method."),void e(null);r.bugReportInfo().then((function(t){return e(JSON.stringify(t))})).catch((function(t){return m.logError("Error while collecting activeBroker info: "+t.message),e(null)}))}))},t.prototype._getScreenerParams=function(){return new Promise((function(e){var n=t.getScreener();if(void 0===n)return m.logWarn("Abort collecting screener params. No screener found."),void e(null);e(n.getCurrentState())}))},t.prototype._getProductId=function(){return Object(u.isOnMobileAppPage)("old")?"ios":Object(u.isOnMobileAppPage)("new")?"android":Object(l.isDesktopApp)()?"desktop":o.enabled("charting_library_base")?"charting_library":"tv"},t.prototype._getExtendedHours=function(){var e,n=t.getChartWidgetCollection();if(!n)return m.logWarn("Abort getting extendedHours property value. No chartWidgetCollection found."),null;try{e=n.activeChartWidget.value().model().mainSeries().properties().extendedHours.value()}catch(r){return m.logError("Error while getting extendedHours property value: "+r.message),null}return"boolean"==typeof e?e:null},t.prototype._getDividendsAdjustment=function(){var e,n=t.getChartWidgetCollection();if(!n)return m.logWarn("Abort getting dividendsAdjustment property value. No chartWidgetCollection found."),null;try{e=n.activeChartWidget.value().model().mainSeries().properties().dividendsAdjustment.value()}catch(r){return m.logError("Error while getting dividendsAdjustment property value: "+r.message),null}return"boolean"==typeof e?e:null},t.prototype._getChartSessionDisconnects=function(){return window.ChartApiInstance?window.ChartApiInstance.disconnectCount():(m.logWarn("Abort getting chart session disconnects count. No ChartApiInstance found."),null)},t.prototype._getChartMarketStatuses=function(){var e=t.getChartWidgetCollection();return e?e.chartMarketStatuses():(m.logWarn("Abort getting market statuses. No chartWidgetCollection found."),[])},t.prototype._getChartSeriesStatuses=function(){var e=t.getChartWidgetCollection()
;return e?e.chartSeriesStatuses():(m.logWarn("Abort getting series statuses. No chartWidgetCollection found."),[])},t.prototype._getUserIsPro=function(){return Boolean(window.user&&window.user.is_pro)},t.prototype._getSubscriptionState=function(){return window.pro&&window.pro.isPaidPro()?d.d.IsPro:window.user.had_pro?d.d.ExPro:void 0},t.prototype._getProOffers=function(){return window.pro&&window.pro.offers&&window.pro.offers()||[]},t.prototype._getTimezone=function(){var e=t.getChartWidgetCollection();if(!e)return m.logWarn("Abort getting timezone. No chartWidgetCollection found."),null;var n=null;try{n=e.activeChartWidget.value().model().model().properties().timezone.value()}catch(r){m.logError("Error while getting timezone: "+r.message)}return n},t.prototype._getPerformanceMetrics=function(){return function(){if(!window.performance||!performance.getEntriesByType)return null;var t=performance.getEntriesByType("navigation");if(0===t.length)return null;var e,n=t[0],r=performance.getEntriesByType("mark"),o=performance.getEntriesByType("paint");return{connection:(e=navigator.connection,{effectiveType:e&&e.effectiveType||"unknown",rtt:e&&e.rtt||-1}),navigation:n.toJSON&&n.toJSON()||"unknown",paints:o.map(_),marks:r.map(_)}}()},t.prototype._sortLogs=function(t,e){return t.timestamp-e.timestamp},t.prototype._getLogHistory=function(){return Object(r.b)(this,void 0,void 0,(function(){var t,e,n,o,i;return Object(r.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),e=Object(g.getRawLogHistory)(),f.a.ownPushStream()?[3,2]:(o=(n=e).concat,[4,f.a.getLogs()]);case 1:e=o.apply(n,[r.sent()]),r.label=2;case 2:return t=e.sort(this._sortLogs).map(g.serializeLogHistoryEntry).join("\n").slice(-8e6),[3,4];case 3:return i=r.sent(),m.logWarn("Error while collecting log history: "+i.message),t=JSON.stringify({error:"logger.getLogHistory(maxLen) failed: "+i.message}),[3,4];case 4:return[2,t]}}))}))},t.prototype._getPingInfo=function(){if(!window.ChartApiInstance)return m.logWarn("Abort getting chart session disconnects count. No ChartApiInstance found."),[];var t=window.ChartApiInstance.getPingInfo();return null!==t?[t.min,t.max,t.avg]:[]},t.prototype._getUserId=function(){return window.user&&window.user.id?window.user.id:null},t.prototype._getUser=function(){return window.user&&window.user.username||"Guest"},t.prototype._getProPlan=function(){return window.user&&window.user.pro_plan&&window.user.pro_plan!==w.ProPlans.Free?window.user.pro_plan:null},t.prototype._getWebSocketAddress=function(){return window.WSBackendConnection?window.WSBackendConnection.getHost():(m.logWarn("Abort getting websocket address. No WSBackendConnection found."),null)},t.prototype._getSessionId=function(){return window.ChartApiInstance?window.ChartApiInstance.sessionid:(m.logWarn("Abort getting websocket address. No ChartApiInstance found."),null)},t.prototype._getReferrer=function(){return location.href},t.prototype._getJsErrors=function(){return window.__tv_js_errors.slice(0,10)},t.prototype._filterEmptyFields=function(t){var e={}
;for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];null!=r&&(!Array.isArray(r)||r.length>0)&&(e[n]=r)}return e},t.prototype._getServerInfo=function(){var t=document.querySelector('meta[name="tv:server-name"]');return null!==t?t.getAttribute("content"):null},t.prototype._getServerTimeOffset=function(){return window.ChartApiInstance?String(Math.round(window.ChartApiInstance.serverTimeOffset()))+"s":(m.logWarn("Abort getting server time offset. No ChartApiInstance found."),null)},t.prototype._getUserSettings=function(){var t=v.a.keys().reduce((function(t,e){var n=v.a.getValue(e);if(n)try{t[e]=JSON.parse(n)}catch(r){t[e]=n}return t}),{});return JSON.stringify(t).slice(0,5e5)},t.prototype._getDomNodesCount=function(){return document.querySelectorAll("*").length},t.prototype._getPageSnapshot=function(){return Object(r.b)(this,void 0,void 0,(function(){var t=this;return Object(r.d)(this,(function(e){return this._data.screenshotAgree?[2,n.e("page-snapshot").then(n.bind(null,"cNFy")).then((function(e){return Object(r.b)(t,void 0,void 0,(function(){var t,n=this;return Object(r.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.generatePageSnapshot({logging:!1,ignoreElements:function(t){return t===n._dialogElement}})];case 1:return[2,r.sent()];case 2:return t=r.sent(),m.logError(t),[2,null];case 3:return[2]}}))}))}))]:(m.logWarn("Abort creating page snapshot. User did not agree to send page snapshot."),[2,null])}))}))},t.prototype._getBuildTime=function(){return window.BUILD_TIME},t.prototype._getPlugins=function(){return void 0!==navigator.plugins?Array.from(navigator.plugins).map((function(t){return{name:t.name,filename:t.filename,description:t.description}})):[]},t}()},iQNB:function(t,e,n){"use strict";var r,o,i,s,a,c,u,l;function d(t){return void 0!==t.event&&void 0!==t.userId}n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return o})),n.d(e,"e",(function(){return i})),n.d(e,"f",(function(){return s})),n.d(e,"d",(function(){return a})),n.d(e,"i",(function(){return d})),n.d(e,"g",(function(){return c})),n.d(e,"h",(function(){return u})),n.d(e,"c",(function(){return l})),function(t){t.Chart="Chart",t.Trading="Trading issue"}(r||(r={})),function(t){t.Other="Other",t.DrawingIssue="Drawings issue",t.StudyNotLoading="Study not loading",t.SlowChart="Slow scrolling or chart loading"}(o||(o={})),function(t){t.Data="Data",t.PineScript="Pine Script issue",t.Alert="Alerts issue",t.Billing="Billing",t.Screener="Screener",t.SocialNetwork="Social network",t.Watchlist="Watchlist",t.MobileApps="Mobile apps",t.Desktop="Desktop",t.Financials="Financials",t.ProfileSettings="Profile settings"}(i||(i={})),function(t){t.Unsubscribe="Unsubscribe",t.ChartDoesNotLoad="Chart does not load",t.NoRealTimeData="No real-time data",t.GapInTheData="Gap in the data",t.PriceIncorrect="Price incorrect"}(s||(s={})),function(t){t.IsPro="Is PRO",t.ExPro="Ex-PRO"}(a||(a={})),function(t){t.FromAgent="0",t.FromUser="2"}(c||(c={})),function(t){t.Received="Received",t.InProgress="In Progress",t.Closed="Closed"}(u||(u={})),
function(t){t[t.Good=103]="Good",t[t.Average=100]="Average",t[t.Bad=-103]="Bad"}(l||(l={}))}}]);