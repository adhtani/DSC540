(window.webpackJsonp=window.webpackJsonp||[]).push([[325],{"5vgT":function(t,i){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22" width="22px" height="22px"><g fill-rule="evenodd"><path d="M12 16h-2v-6h2v6zm0-8h-2V6h2v2z"/><path d="M11.016.25C5.09.25.282 5.06.282 10.984c0 5.925 4.81 10.734 10.734 10.734 5.925 0 10.734-4.81 10.734-10.734S16.94.25 11.016.25zm0 1.5c5.096 0 9.234 4.138 9.234 9.234s-4.138 9.234-9.234 9.234-9.234-4.138-9.234-9.234S5.92 1.75 11.016 1.75z"/></g></svg>'},JJau:function(t,i,o){"use strict";function n(t){return t.childElementCount?Array.prototype.map.call(t.childNodes,n).join("")+("DIV"===t.tagName?"\n":""):"BR"===t.tagName?"\n":t.textContent||""}o.r(i),o.d(i,"getInnerTextContent",(function(){return n}))},P6OK:function(t,i,o){},sMRa:function(t,i,o){"use strict";o.r(i),function(t){o.d(i,"GlobalNotificationTools",(function(){return S}));o("P5fv"),o("7XZl"),o("YFKU")
;var n=o("JWp+"),e=o("PQvG"),a=o("Vdly"),s=o("aIyQ"),l=o.n(s),c=o("hY0g"),d=o.n(c),r=o("TxTq"),f=o.n(r),u=o("qjxE"),_=o("JJau"),b=o("xkbY"),h=o("FBuY"),v=o("c2JX"),g=o("uFcS"),p=o("5vgT"),N=o("uo4K"),w='<div class="tv-feed-list__item tv-global-notification-block" data-notification-id="{{id}}">\n\t\t<div class="tv-global-notification-block__general">\n\t\t\t<div class="tv-global-notification-block__read-flag-wrap js-global-notifications-unread-flag">\n\t\t\t\t{{#unread}}\n\t\t\t\t\t<span class="tv-global-notification-block__icon-bulb">'+g+'</span>\n\t\t\t\t{{/unread}}\n\t\t\t</div>\n\t\t\t<div class="tv-global-notification-block__time tv-global-notification-block__section-right">\n\t\t\t\t<div class="tv-global-notification-block__time-item">\n\t\t\t\t\t<span class="tv-global-notification-block__time-label"><time></time></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="tv-global-notification-block__text-wrap">\n\t\t\t\t<div class="tv-global-notification-block__text">\n\t\t\t\t\t{{{notification}}}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>',m='<span class="tv-header__dropdown-wrap tv-header__dropdown-wrap--global-notifications tv-dropdown-behavior__button tv-header__dropdown-wrap--noarrow apply-common-tooltip" title="'+$.t("What's New")+'"></span>\n\t<span class="tv-dropdown-behavior__body i-hidden tv-header__dropdown-body tv-header__dropdown-body--global-notifications tv-header__dropdown-body--fixwidth tv-header__dropdown-body--scrollable">\n\t\t<span class="tv-header__dropdown-scroll tv-dropdown-behavior__scroll">\n\t\t\t<span class="tv-header__dropdown-inscroll tv-dropdown-behavior__inscroll">\n\t\t\t\t<span class="tv-dropdown-behavior__item">\n\t\t\t\t\t<div class="tv-header__dropdown-body--global-notifications-list">\n\t\t\t\t\t\t<div class="tv-header__dropdown-body--global-notifications-item">\n\t\t\t\t\t\t\t<div class="tv-site-widget">\n\t\t\t\t\t\t\t\t<div class="tv-site-widget__body js-global-notifications-list">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tv-header__dropdown-body--global-notifications-item tv-dropdown-behavior__item tv-header__dropdown-body--global-notifications-spinner js-global-notifications-spinner"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t</span>\n\t</span>',I='<div class="tv-header__icon--global-notifications-wrap">\n\t\t<span class="tv-header__icon tv-header__icon--global-notifications-inner tv-header__icon--global-notifications js-global-notifications-header-icon">'+p+"</span>\n\t</div>",A='<div class="tv-device-menu__header tv-device-menu--notifications-header">\n\t\t<span class="tv-device-menu__btn tv-device-menu__btn--close js-device-menu__close">'+N+'</span>\n\t\t<div class="tv-device-menu--notifications-header-title">'+$.t("What's New")+'</div>\n\t</div>\n\t<div class="tv-device-menu__body tv-device-menu--notifications-body">\n\t\t<div class="tv-device-menu__inner tv-device-menu--notifications-inner-body"></div>\n\t\t<div class="tv-device-menu__footer js-global-notifications-spinner">\n\t\t</div>\n\t</div>',S=function(){
function i(){if(i._instance)return i._instance;i._instance=this,this._dataLoading=!1,this._dialog=null,this._firstTimeDialog=!0,this._isAllNotificationsShowed=!1,this._newNotificationIds=[],this._deleteNotificationIds=[],this._lastShowedNotificationId=null,this._unreadNotificationsCount=new d.a(0);var t=window.lastGlobalNotificationIds;try{this._lastId=a.getInt(i.settingsKey,0)}catch(e){this._lastId=0}if(this._lastId){for(var o=0,n=0;n<t.length;n++)t[n]>this._lastId&&(o+=1);this._unreadNotificationsCount.setValue(o)}else t.length>0&&this._changeLastId(t[0]);return i._instance}return i.prototype.getUnreadNotificationsCount=function(){return this._unreadNotificationsCount},i.prototype.constructNotificationsMenu=function(i){i.addClass("tv-dropdown-behavior tv-header__dropdown").data("scroll",!0).data("item-coeff",1.6),i.html(m),i.find(".tv-header__dropdown-wrap").html(t.render(I,null))},i.prototype.initNotificationsMenu=function(t){var o=this;this._isAllNotificationsShowed=!1,this._lastShowedNotificationId=null;var e=t.find(".tv-dropdown-behavior__body"),a=e.find(".js-global-notifications-list"),s=e.find(".js-global-notifications-spinner"),l=t.tvDropdown("getInstance"),c=l.scroll||null,d=t.find(".js-global-notifications-header-icon");this._unreadNotificationsCount.value()>0&&i._setUnreadCounterIcon(d,this._unreadNotificationsCount.value()),this._subscribeScrollToEnd(c,s[0],(function(t){t.globalNotifications&&t.globalNotifications.length&&o._updateNotificationsList(t,a,(function(){c&&c.updateScrollBar()}))})),this._subscribeNewGlobalNotificationInListIndicator(d,(function(){return l.isOpened()}),a,(function(){c&&c.scrollToStart()})),this._subscribeDeleteGlobalNotificationInListIndicator((function(){return l.isOpened()}),a),this._subscribeDeleteNewNotificationDelegateInListIndicator(d),this._subscribeReadAllNotificationsDelegateInListIndicator(d),this._subscribeTVXWindowReadAllNotificationsInListIndicator(d),t.on("beforeOpenMenu",(function(){a.empty(),i.bigAjaxSpinner.spin(e[0])})),t.on("afterOpenMenu",(function(){o._lastShowedNotificationId=null,o._dataLoading=!0,Object(n.getGlobalNotifications)(o._lastShowedNotificationId,i.ITEMS_PER_PAGE).then((function(n){n.globalNotifications&&n.globalNotifications.length?(o._lastShowedNotificationId=n.globalNotifications[n.globalNotifications.length-1].id,o._createNotificationsList(n,a,(function(t){i._makeNotificationElement(t).appendTo(a)}),(function(){t.tvDropdown("updateScroll"),i._setAllNotificationsWatchedIcon(d),i._broadcastReadAllNotifications()}))):i.bigAjaxSpinner.stop()}))})),t.on("afterCloseMenu",(function(){i.miniAjaxSpinner.stop(),o._unreadNotificationsCount.setValue(0)}))},i.prototype.constructDeviceNotificationsMenu=function(t){t.html(A)},i.prototype.constructDeviceNotificationsButton=function(i){i.addClass("tv-header__global-notifications-menu apply-common-tooltip").attr("title",$.t("What's New")).data("scroll",!0).data("item-coeff",1.6).data("device-menu-id","notifications").html(t.render(I,null))},i.prototype.initDeviceNotificationsMenu=function(t,o){var e=this
;if(t.length){this._isAllNotificationsShowed=!1,this._lastShowedNotificationId=null;var a=t.find(".tv-device-menu__inner"),s=t.find(".tv-device-menu__body"),l=s.find(".js-global-notifications-spinner"),c=o.find(".js-global-notifications-header-icon");this._unreadNotificationsCount.value()>0&&i._setUnreadCounterIcon(c,this._unreadNotificationsCount.value()),t.tvDeviceMenu("getInstance").scrolltoend.subscribe(this,(function(){e._scrollToEnd(l[0]).then((function(t){t.globalNotifications&&t.globalNotifications.length&&e._updateNotificationsList(t,a)}))})),this._subscribeNewGlobalNotificationInListIndicator(c,(function(){return!t.hasClass("i-hidden")}),a,(function(){s.scrollTop(0)})),this._subscribeDeleteGlobalNotificationInListIndicator((function(){return!t.hasClass("i-hidden")}),a),this._subscribeDeleteNewNotificationDelegateInListIndicator(c),this._subscribeReadAllNotificationsDelegateInListIndicator(c),this._subscribeTVXWindowReadAllNotificationsInListIndicator(c),t.on("deviceMenuBeforeOpen",(function(){a.empty(),i.bigAjaxSpinner.spin(s[0])})),t.on("deviceMenuAfterOpen",(function(){e._lastShowedNotificationId=null,e._dataLoading=!0;var t=i._countItemsInsideBodyElement(s)+1;Object(n.getGlobalNotifications)(e._lastShowedNotificationId,t).then((function(t){t.globalNotifications&&t.globalNotifications.length?(e._lastShowedNotificationId=t.globalNotifications[t.globalNotifications.length-1].id,e._createNotificationsList(t,a,(function(t){i._makeNotificationElement(t).appendTo(a)}),(function(){i._setAllNotificationsWatchedIcon(c),i._broadcastReadAllNotifications()}))):i.bigAjaxSpinner.stop()}))})),t.on("deviceMenuAfterClose",(function(){i.miniAjaxSpinner.stop(),e._unreadNotificationsCount.setValue(0)}))}},i.prototype.showNotificationsDialog=function(){var e=this;this._isAllNotificationsShowed=!1,this._lastShowedNotificationId=null;var a=$(t.render('<div class="tv-global-notification-block__dialog-content">\n\t\t<div class="tv-site-widget">\n\t\t\t<div class=" js-global-notifications-list"></div>\n\t\t</div>\n\t\t<div class="tv-global-notification-block__dialog-item-spinner js-global-notifications-spinner"></div>\n\t</div>',null)),s=a.find(".js-global-notifications-list"),l=a.find(".js-global-notifications-spinner");Promise.all([o.e("vendors"),o.e("dialogs-core"),o.e(11),o.e(18),o.e(26),o.e(30),o.e(36),o.e(35),o.e(34),o.e("create-dialog")]).then(function(t){var c=o("YDhE").createDialog;e._dialog=c({content:a,destroyOnClose:!0,height:540,title:$.t("What's New"),width:500}),e._dialog.on("beforeClose",(function(){e._dialog=null,e._unreadNotificationsCount.setValue(0)})),e._dialog.open(),e._subscribeScrollToEnd(e._dialog.scroll,l[0],(function(t){t.globalNotifications&&t.globalNotifications.length&&e._updateNotificationsList(t,s,(function(){e._dialog&&e._dialog.scroll&&e._dialog.scroll.updateScrollBar()}))})),i.bigAjaxSpinner.spin(a[0]),e._dataLoading=!0,Object(n.getGlobalNotifications)(e._lastShowedNotificationId,i.ITEMS_PER_PAGE).then((function(t){
t.globalNotifications&&t.globalNotifications.length?(e._lastShowedNotificationId=t.globalNotifications[t.globalNotifications.length-1].id,e._createNotificationsList(t,s,(function(t){i._makeNotificationElement(t).appendTo(s)}),(function(){e._dialog&&e._dialog.updateScroll(),i._broadcastReadAllNotifications()}))):i.bigAjaxSpinner.stop()}))}.bind(null,o)).catch(void 0)},i.prototype.subscribeNotificationsDialogToPushStream=function(){var t=this;if(this._firstTimeDialog){this._firstTimeDialog=!1;var o=function(){return null!=t._dialog};this._subscribeNewGlobalNotification(o,(function(o){var n=i._makeNotificationElement(o);if(t._dialog){var e=t._dialog.$el.find(".js-global-notifications-list");e&&n.prependTo(e),t._dialog.scroll&&t._dialog.scroll.scrollToStart(),t._unreadNotificationsCount.setValue(0)}return t._changeLastId(o.id),i._broadcastReadAllNotifications(),n}),void 0,!0),this._subscribeDeleteGlobalNotification(o,(function(i){t._dialog&&t._dialog.$el.find(".js-global-notifications-list").find('[data-notification-id="'+i.id+'"]').remove()})),this._subscribeTVXWindowReadAllNotifications()}},i.prototype._createNotificationsList=function(t,o,n,e){var a=this;this._isAllNotificationsShowed=!1,o.empty(),i.bigAjaxSpinner.stop(),t.globalNotifications.forEach((function(t,i){t.unread=i<a._unreadNotificationsCount.value(),n(t)})),this._unreadNotificationsCount.value()>0&&this._changeLastId(t.globalNotifications[0].id);var s=this._unreadNotificationsCount.value()-i.ITEMS_PER_PAGE;s<0&&(s=0),this._unreadNotificationsCount.setValue(s),this._dataLoading=!1,i._fadeOutUnreadFlags(o),e&&e()},i.prototype._updateNotificationsList=function(t,o,n){var e=this;t.globalNotifications.forEach((function(t,n){t.unread=n<e._unreadNotificationsCount.value();var a=i._makeNotificationElement(t);a.appendTo(o),t.unread&&i._fadeOutUnreadFlags(a)}));var a=this._unreadNotificationsCount.value()-i.ITEMS_PER_PAGE;a<0&&(a=0),this._unreadNotificationsCount.setValue(a),this._dataLoading=!1,i.miniAjaxSpinner.stop(),n&&n()},i.prototype._processNewNotification=function(t){var o=t.closedListCallBack,n=t.isListOpened,a=t.itemCallBack,s=t.newNotification,l=t.showToast||!1;if(s.language===i.locale||"all"===s.language)if(n){s.unread=!0;var c=a(s);null!=c&&i._fadeOutUnreadFlags(c)}else this._newNotificationIds.includes(s.id)||(this._newNotificationIds.push(s.id),this._unreadNotificationsCount.setValue(this._unreadNotificationsCount.value()+1),s.important&&l&&Object(b.a)(s.notification),e.show($.t("New Update"),Object(_.getInnerTextContent)($("<div>").html(s.notification)[0]))),o&&o()},i.prototype._processDeleteNotification=function(t){var o=t.isListOpened,n=t.itemCallBack,e=t.deleteNotification;if(e.language===i.locale||"all"===e.language)if(o)n&&n(e);else if(!this._deleteNotificationIds.includes(e.id)&&(this._deleteNotificationIds.push(e.id),this._lastId<e.id)){var a=this._unreadNotificationsCount.value()-1;a<0&&(a=0),this._unreadNotificationsCount.setValue(a),i._deleteNewNotificationDelegate.fire()}},i.prototype._scrollToEnd=function(t){var o=this
;return new Promise((function(e){o._isAllNotificationsShowed||o._dataLoading||(i.miniAjaxSpinner.spin(t),o._dataLoading=!0,Object(n.getGlobalNotifications)(o._lastShowedNotificationId,i.ITEMS_PER_PAGE).then((function(t){if(!t.globalNotifications||!t.globalNotifications.length)return o._isAllNotificationsShowed=!0,void i.miniAjaxSpinner.stop();o._lastShowedNotificationId=t.globalNotifications[t.globalNotifications.length-1].id,e(t)})))}))},i.prototype._subscribeScrollToEnd=function(t,i,o){var n=this;t&&t.scrolltoend.subscribe(this,(function(){n._scrollToEnd(i).then(o)}))},i.prototype._subscribeNewGlobalNotification=function(t,o,n,e){var a=this;f.a.on(i.onPushStreamNewGlobalNotification,(function(i){a._processNewNotification({closedListCallBack:n,isListOpened:t(),itemCallBack:o,newNotification:i,showToast:e})}))},i.prototype._subscribeNewGlobalNotificationInListIndicator=function(t,o,n,e){var a=this;this._subscribeNewGlobalNotification(o,(function(t){var o=i._makeNotificationElement(t);return o.prependTo(n),a._changeLastId(t.id),e&&e(),o}),(function(){i._setUnreadCounterIcon(t,a._unreadNotificationsCount.value())}))},i.prototype._subscribeDeleteGlobalNotification=function(t,o){var n=this;f.a.on(i.onPushStreamDeleteGlobalNotification,(function(i){n._processDeleteNotification({deleteNotification:i,isListOpened:t(),itemCallBack:o})}))},i.prototype._subscribeDeleteGlobalNotificationInListIndicator=function(t,i){this._subscribeDeleteGlobalNotification(t,(function(t){i.find('[data-notification-id="'+t.id+'"]').remove()}))},i.prototype._subscribeReadAllNotificationsDelegate=function(t){i._readAllNotificationsDelegate.subscribe(null,t)},i.prototype._subscribeReadAllNotificationsDelegateInListIndicator=function(t){this._subscribeReadAllNotificationsDelegate((function(){i._setAllNotificationsWatchedIcon(t)}))},i.prototype._subscribeDeleteNewNotificationDelegate=function(t,o){var n=this;i._deleteNewNotificationDelegate.subscribe(null,(function(){n._unreadNotificationsCount.value()>0?o():t()}))},i.prototype._subscribeDeleteNewNotificationDelegateInListIndicator=function(t){var o=this;this._subscribeDeleteNewNotificationDelegate((function(){i._setAllNotificationsWatchedIcon(t),i._broadcastReadAllNotifications()}),(function(){i._setUnreadCounterIcon(t,o._unreadNotificationsCount.value())}))},i.prototype._subscribeTVXWindowReadAllNotifications=function(t){var o=this;h.TVXWindowEvents.on(i.onTVXWindowReadAllNotifications,(function(){t&&t(),o._unreadNotificationsCount.setValue(0)}))},i.prototype._subscribeTVXWindowReadAllNotificationsInListIndicator=function(t){this._subscribeTVXWindowReadAllNotifications((function(){i._setAllNotificationsWatchedIcon(t)}))},i.prototype._changeLastId=function(t){this._lastId!==t&&(this._lastId=t,a.setValue(i.settingsKey,t,{forceFlush:!0}))},i._makeNotificationElement=function(i){var o=$(t.render(w,i));return Object(u.jQueryCompatibleAgoDateFormatter)(o.find(".tv-global-notification-block__time-label time"),new Date(1e3*i.created)),o},i._setUnreadCounterIcon=function(o,n){
var e=n>i.MAX_COUNT?i.MAX_COUNT+"+":n;o.removeClass("tv-header__icon--global-notifications"),o.html(t.render('<span class="tv-header__indicator--global-notifications">{{unreadCount}}</span>\n\t<div class="tv-header__red-dot--global-notifications">\n\t\t<i class="tv-header__icon--counter-red tv-header__icon--counter-red-global-notifications"></i>\n\t</div>',{unreadCount:e}))},i._fadeOutUnreadFlags=function(t){i.UNREAD_FLAGS_FADE_OUT_TIME>0&&t.find(".js-global-notifications-unread-flag").animate({opacity:0},i.UNREAD_FLAGS_FADE_OUT_TIME)},i._setAllNotificationsWatchedIcon=function(t){t.empty(),t.addClass("tv-header__icon--global-notifications"),t.html(p)},i._countItemsInsideBodyElement=function(t){return Math.ceil(t.height()/60)},i._broadcastReadAllNotifications=function(){i._readAllNotificationsDelegate.fire(),h.TVXWindowEvents.emit(i.onTVXWindowReadAllNotifications)},i.ITEMS_PER_PAGE=10,i.MAX_COUNT=10,i.UNREAD_FLAGS_FADE_OUT_TIME=0,i.locale=window.locale||"en",i.settingsKey="en"===i.locale?"globalNotification":"globalNotification_"+i.locale,i.onTVXWindowReadAllNotifications="en"===i.locale?"read-all-global-notifications":"read-all-global-notifications_"+i.locale,i.onPushStreamNewGlobalNotification="new-global-notification",i.onPushStreamDeleteGlobalNotification="delete-global-notification",i.bigAjaxSpinner=new v.Spinner,i.miniAjaxSpinner=new v.Spinner("mini"),i._readAllNotificationsDelegate=new l.a,i._deleteNewNotificationDelegate=new l.a,i}()}.call(this,o("nbsC"))},uFcS:function(t,i){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 14" width="10px" height="14px"><circle cx="5" cy="7" r="3"/></svg>'},xkbY:function(t,i,o){"use strict";o.d(i,"a",(function(){return e}));var n=o("mrSG");o("NNtz");function e(t){return Object(n.b)(this,void 0,void 0,(function(){return Object(n.d)(this,(function(i){switch(i.label){case 0:return[4,Promise.all([o.e(91),o.e(112),o.e(127),o.e(566),o.e(103),o.e("global-notification")]).then(o.bind(null,"K9fc"))];case 1:return i.sent().showGlobalNotificationToast(t),[2]}}))}))}}}]);