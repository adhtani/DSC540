(window.webpackJsonp=window.webpackJsonp||[]).push([["price-alerts-dispatcher"],{"15Qe":function(t,e,r){"use strict";r.r(e),r.d(e,"getNotificationFromPriceEvent",(function(){return a})),r.d(e,"getNotificationFromAlertStopped",(function(){return c}));r("YFKU"),r("HbRj");var n=r("JZcM"),i=r("IWHC"),o=r("hp/T"),s=r("zNIe");function a(t){var e=t.shortSymbol(),r=t.get("symbol");return{id:"fired:price:"+t.id,fired:new Date(t.get("fireTime")),type:n.a.Fired,desktopNotificationTitle:window.t("Alert on {shortSymbol}").format({shortSymbol:e}),dialogTitle:window.t("Alert on {shortSymbol}").format({shortSymbol:'<a data-symbol="'+r+'" class="js-symbol" href="'+Object(s.a)(r)+'" target="_blank">'+e+"</span>"}),description:t.get("description"),title:e,alertId:Number(t.get("alertId")),alertCategory:i.AlertCategory.Price,eventId:t.get("id"),notifyWith:{email:!!t.get("sendEmail"),popup:!!t.get("showPopup"),sms:!!t.get("sendSms"),sound:!!t.get("playSound")},soundParams:{duration:t.get("soundDuration")||0,name:t.get("soundFile")||o.DEFAULT_SOUNDS.alert}}}function c(t){if("fire_control"===t.reason){var e=new Date(6e4*Math.round(Date.now()/6e4));return{id:"fire_control:price:"+t.alertId+":"+e.getTime()/1e3,fired:e,type:n.a.FireControl,desktopNotificationTitle:t.shortSymbol+window.t("The alert is triggered too often"),description:t.description,title:t.shortSymbol,alertId:t.alertId,alertCategory:i.AlertCategory.Price,notifyWith:{popup:!0}}}return null}},"2qdo":function(t,e,r){"use strict";function n(){return Promise.all([r.e("vendors"),r.e("dialogs-core"),r.e(11),r.e(18),r.e(26),r.e(36),r.e(477),r.e(35),r.e(34),r.e(65),r.e("alert-notifier")]).then(r.bind(null,"Z59a")).then((function(t){return t.createAlertNotifier()}))}r.r(e),r.d(e,"createAlertNotifier",(function(){return n}))},"3DsO":function(t,e,r){"use strict";r.r(e),r.d(e,"showGoProInfExpDialog",(function(){return i}));var n=r("oOPW");function i(){Object(n.createGoProDialog)({feature:"alertsNoExpiration"})}},"3Tqy":function(t,e,r){"use strict";(function(n){Object.defineProperty(e,"__esModule",{value:!0});var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},o=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!e||r.length!==e);n=!0);}catch(c){i=!0,o=c}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};e.prepareAlertsModels=z;var s,a=r("brCa"),c=r("ZF9k"),l=r("0dm4"),u=r("15Qe"),d=r("IWHC"),f=r("jA5l"),p=r("aIyQ"),h=(s=p)&&s.__esModule?s:{default:s},_=r("PfBM"),v=r("uOo4"),m=r("8I+7"),y=r("K81e")
;var g=r("ijto").allSettled,S=r("2O5g").invokeAlertEditor,b=r("1UCy").AlertEditorAbortReason,A=r("sg6D"),x=r("Evi4").AlertVersioning,E=r("4pku").Alert,w=r("nmnj"),T=r("dfhE"),I=r("TxTq"),P=r("JWMC").trackEvent,D=r("NP3r").enabled,O=r("bKsZ").ProductFeatures,k=r("oNDq").createConfirmDialog,N=r("txPx").getLogger("Alerts.Price.Dispatcher"),C=r("hWRP").sendRequest,M=r("2qdo").createAlertNotifier,R=r("4BMm").server2clientParams,L=r("4BMm").client2serverParams,q=r("xlbu").telemetry,F=r("Zdjc").showGoProAlertsTrueSmsDialog,W=r("gdgp").showGoProMaxAlertsDialog,j=r("3DsO").showGoProInfExpDialog,U=r("zL88").showWarningAlertsMaxTotalCountExceeded,V="cancelled: new alert already generating",B=r("flg1").showAlertsMaintenanceDialog,H=r("8woN");function Y(){var t=this;this._loading={},this._alertVersioning=new x,this._lastGenIds={},this._notifierPromise=null,this._onPushStreamMessage=new h.default,this._onPushStreamStatusChanged=function(e){e===_.ConnectionStatus.Open&&t._onPushStreamMessage.fire({source:"host",data:{m:"pushstream_ready"}})},this.alerts=new(n.Collection.extend({model:E})),this.events=new(n.Collection.extend({comparator:function(t,e){var r=t.get("fireTime"),n=e.get("fireTime");return r&&n?n-r:r?n?void 0:1:-1},model:A})),this._attachHandlers()}function G(t){t.forEach((function(t){return t.set("selected",!1)}))}function J(t,e){t.forEach((function(t){t!==e&&t.set("selected",!1)}))}function K(t){var e=new Date;t.get("expired")<e&&(e.setMonth(e.getMonth()+1),t.set("expired",e))}function z(t,e){return new Promise((function(r,n){var i=t.map(R).map((function(t){var r=e(t);return r.catch((function(e){return N.logError("Migration failed. Alert ID: "+t.id+". Error: "+e)})),r}));g(i).then((function(t){var e=t.filter((function(t){return"fulfilled"===t.status})).map((function(t){return new E(t.value)}));r(e)}))}))}Y.checkProPermissions=function(t){return t.get("sendTrueSms")&&!D(O.ALERTS_TRUE_SMS)?(F(),!1):t.get("noExpiration")&&!D(O.ALERTS_NO_EXPIRATION)?(j(),!1):"string"!=typeof t.get("webhookUrl")||D(O.ALERTS_WEBHOOK)?!!(0,l.canPlaceAlertOnResolution)(t.get("resolution"))||((0,c.showGoProAlertsOnSecondsDialog)(),!1):((0,f.showGoProAlertsWebhookDialog)(),!1)},Y.getAnalyticsHeaders=function(t,e){return{"X-Analytics-Price-Alert-Condition":String(t),"X-Analytics-Price-Alert-Action-Source":String(e)}},Y.prototype._onLoginStateChange=function(t){is_authenticated?(t||setTimeout(this.showOfflineEvents.bind(this),1),this._refreshPushStream()):(this.alerts.reset(),this.events.reset(),this._alertVersioning.cancelAllPossibleExtraUpdates()),this._offlineEventsRequestWasSent=!1,this._fullListWasRequested=!1},Y.prototype._attachHandlers=function(){var t=this;function e(e){var r=t.chartWidget(),n=r?r.model():null;if(n){var i=n.hoveredSource();e.set("hovered",i&&i.hasAlert&&i.hasAlert.value()&&i.alertId()===e.id);var o=n.selection().dataSources().some((function(t){return t.hasAlert.value()&&t.alertId()===e.id}));e.set("selected",o)}}loginStateChange.subscribe(this,this._onLoginStateChange.bind(this)),this._onLoginStateChange(!0),
t.alerts.on("add",(function(r){e(r),r.isDrawing()&&function(e){var r=t.chartWidget()&&t.chartWidget().model();if(r){var n=e.get("extra").drawing(),i=r.dataSourceForId(n.id);i&&!i.hasAlert.value()&&i.canHasAlert()&&i.setAlert(e.id)}}(r)})).on("change:selected",(function(e,r,n){if(r){var i=t.alerts;G(t.events),J(i,e)}})).on("change:id",e).on("destroy",(function(e){e.isNew()||t.events.where({alertId:e.id}).forEach((function(t){t.destroy()}))})),t.events.on("change:selected",(function(e,r,n){var i=t.events.models;r&&(G(t.alerts),J(i,e))})),t.alerts.on("change:id",(function(e){var r=!1,n=!0,i=!1,o=void 0;try{for(var s,a=t.alerts.models[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){s.value.id===e.id&&(r?N.logWarn("Two alerts share the same id "+e.id+", which may lead to undefined behaviour"):r=!0)}}catch(c){i=!0,o=c}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}}))},Y.prototype.showOfflineEvents=function(){var t=this;if(!window.is_authenticated||this._offlineEventsRequestWasSent)return Promise.resolve();this._offlineEventsRequestWasSent=!0;return Promise.all([this.sendRequest({method:"get_offline_events",preventMaintenanceDialog:!0,params:{}}),this.getAlertNotifier()]).then((function(e){var r=o(e,2),n=r[0],s=n.fires,a=n.fire_controls,c=r[1],l=Object.keys(s);l.length>0&&t.sendRequest({method:"clear_shown_events",preventMaintenanceDialog:!0,params:{alerts_ids:l.map((function(t){return parseInt(t)}))}}).catch((function(t){N.logError("Could not mark offline events as shown: "+t)}));var d=l.map((function(t){return s[t].latest_event})).sort((function(t,e){return t.id-e.id})),f=!0,p=!1,h=void 0;try{for(var _,v=d[Symbol.iterator]();!(f=(_=v.next()).done);f=!0){var m=_.value,y=new A(R(m));t.events.add(y),y.trigger("fired",y);var g=t.alerts.get(y.get("alertId"));void 0!==g&&g.trigger("fired",g),c.addNotification(i({},(0,u.getNotificationFromPriceEvent)(y),{count:s[y.get("alertId")].events_count}))}}catch(I){p=!0,h=I}finally{try{!f&&v.return&&v.return()}finally{if(p)throw h}}d.length>0&&t.events.trigger("offline_events");var S=!0,b=!1,x=void 0;try{for(var E,w=Object.values(a)[Symbol.iterator]();!(S=(E=w.next()).done);S=!0){var T=E.value;c.addNotification((0,u.getNotificationFromAlertStopped)({alertId:T.id,description:T.desc,reason:"fire_control",shortSymbol:H.shortName(T.sym)}))}}catch(I){b=!0,x=I}finally{try{!S&&w.return&&w.return()}finally{if(b)throw x}}}),(function(t){N.logError("Failed to get offline events: "+t)}))},Y.prototype._refreshPushStream=function(){I.off("alert"),I.offStatus(this._onPushStreamStatusChanged),is_authenticated&&(I.on("alert",this._onMessage.bind(this)),I.onPrivateStatus(this._onPushStreamStatusChanged))},Y.prototype._onMessage=function(t){var e,r,n,o,s,a=this;if(t)switch(N.logNormal(t),r=JSON.parse(t),this._onPushStreamMessage.fire({source:"alert",data:r}),n=r.m,e=R(r.p),n){case"alert_running":a._alertVersioning.cancelPossibleExtraUpdate(e.id),a._alertVersioning.migrate(e).then((function(t){(o=a.alerts.get(t.id))?o.set(t):a.alerts.add(t,{at:0})}));break;case"alert_stopped":
if(o=a.alerts.get(e.id)){var c={active:!1,stopReason:e.stopReason,error:e.error};o.set(c)}"fire_control"===e.stopReason&&a.getAlertNotifier().then((function(t){a.requestAlert(e.id,{success:function(r){var n=(0,u.getNotificationFromAlertStopped)({alertId:r.id,description:r.get("description"),reason:e.stopReason,shortSymbol:r.shortSymbol()});n&&t.addNotification(n)}})}));break;case"alert_deleted":a._alertVersioning.cancelPossibleExtraUpdate(e.id),(o=a.alerts.get(e.id))&&o.destroy();break;case"event":this.getAlertNotifier().then(function(t){s=new A(i({},e)),a.events.add(s);var r=(0,u.getNotificationFromPriceEvent)(s);t.addNotification(r),s.trigger("fired",s),s.trigger("fired:online",s);var n=a.alerts.get(e.alertId);void 0!==n&&(n.set({fireTime:e.fireTime}),n.trigger("fired",n)),this.sendRequest({method:"clear_shown_events",preventMaintenanceDialog:!0,params:{alerts_ids:[e.alertId]}})}.bind(this))}},Y.prototype.cloneAlert=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(0,v.isAlertCloneable)(t))return"function"==typeof e.error&&e.error("Cannot clone alert"),void("function"==typeof e.complete&&e.complete());var r=t.getLocalClone();K(r),this.alerts.add(r),this.createAlert(r,i({},e,{eventName:"clone"}))},Y.prototype.createLocalAlert=function(t,e){var r;return e&&function(t){if(!t)throw new Error("Can't create alert. 'params' is required");for(var e=["symbol","resolution","expired","autoDeactivation","sendEmail","sendSms","sendTrueSms","showPopup","playSound","description","script"],r=[],n=e.length-1;n>=0;n--){var i=e[n];i in t||r.push(i)}r.length&&N.logError("[Alerts] Can't create alert. "+r.join(" ,")+(1===r.length?" is":" are")+" required")}(t),r=new E(t),this.alerts.add(r),r},Y.prototype.createAlert=function(t,e){var r=this;e=e||{};function n(t,r){"function"==typeof e.complete&&e.complete(),"function"==typeof e.error&&e.error(t,r)}if(t instanceof E){if(Y.checkProPermissions(t)){var i=Date.now(),o=t.prepareToSend();return r._generateScriptWithCancellation(t).then((function(n){return o.script=n.IL,n.inputs&&(o.inputs=n.inputs),r.sendRequest({headers:Y.getAnalyticsHeaders(t.get("extra").conditionId(),e.actionSource),method:"create_alert",params:o,success:function(n){n=R(n||{});var i=r.alerts.get(n.id);i?(r.alerts.remove(t),t=i):(n.active=!0,t.set(n)),r._gaTrackEvent(e.eventName||"create",t,e.eventLabel),"function"==typeof e.success&&e.success(t)},complete:function(){var r=Date.now()-i;q.sendReport("alerts","full_time_frame",{value:r}),"function"==typeof e.complete&&e.complete(t)},error:e.error})})).catch((function(t){if(t===V)return N.logNormal("Alert generation is cancelled because next alert generation is started"),V;"function"==typeof e.error&&e.error("Can't generate source code: "+t),"function"==typeof e.complete&&e.complete()}))}n("cannot create alert with current pro plan",!0)}else n("'alert' should be instance of Alert")},Y.prototype.stopAlert=function(t,e){var r,n,i=this;e=e||{};t instanceof E?n=(r=t).get("id"):(n=t,r=i.alerts.get(n)),n?i.sendRequest({method:"stop_alert",params:{id:n
},success:function(){i._gaTrackEvent("stop"),r&&r.set("active",!1),"function"==typeof e.success&&e.success()},error:e.error,complete:e.complete}):N.logError("Alert id is required to stop alert")},Y.prototype.stopAllAlerts=function(t){var e,r=this,n={cross_int:!0};(t=t||{}).symbol&&(n.symbol=t.symbol),t.resolution&&(n.resolution=t.resolution),t.showConfirm&&(e=t.symbol||t.resolution?$.t("Do you really want to stop filtered Alerts?"):$.t("Do you really want to stop all Alerts?")),r.sendRequest({method:"stop_all",params:n,success:function(){r._gaTrackEvent("stop_all"),r.alerts.each((function(t){n.symbol&&n.symbol!==t.get("symbol")||n.resolution&&n.resolution!==t.get("resolution")||t.set("active",!1)})),"function"==typeof t.success&&t.success()},confirmation:e,error:t.error,complete:t.complete})},Y.prototype.deleteAlert=function(t,e){var r,n,i,o=this;e=e||{};if(t instanceof E?i=(n=t).get("id"):(i=t,n=o.alerts.get(i)),n&&n.isNew())return n.destroy(),void("function"==typeof e.complete&&e.complete());i?(e.showConfirm&&(r=$.t("Do you really want to delete Alert '{0}' ?").format(n?n.title():i)),o.sendRequest({method:"delete_alert",params:{id:i},success:function(){o._gaTrackEvent("delete"),"function"==typeof e.success&&e.success(),n&&n.destroy()},error:e.error,cancel:e.cancel,complete:e.complete,confirmation:r})):N.logError("Alert id is required to delete alert")},Y.prototype.deleteAllAlerts=function(t){var e,r=this,n={crossInterval:!0};(t=t||{}).symbol&&(n.symbol=t.symbol),t.resolution&&(n.resolution=t.resolution),"boolean"==typeof t.active&&(n.active=t.active),t.showConfirm&&(e=!1!==n.active||n.symbol||n.resolution?n.symbol||n.resolution||n.active?$.t("Do you really want to delete filtered Alerts?"):$.t("Do you really want to delete all Alerts?"):$.t("Do you really want to delete all inactive Alerts?")),r.sendRequest({method:"delete_all",params:n,success:function(){var e,i={};for(r._gaTrackEvent("delete_all"),n.symbol&&(i.symbol=n.symbol),n.resolution&&(i.resolution=n.resolution),"boolean"==typeof n.active&&(i.active=n.active),e=r.alerts.findWhere(i);e;)e.destroy(),e=r.alerts.findWhere(i);"function"==typeof t.success&&t.success()},error:t.error,complete:t.complete,confirmation:e})},Y.prototype.restartAlert=function(t,e){var r,n,i=this;e=e||{};if(t instanceof E?r=t:(n=t,r=i.alerts.get(n)),r){if(K(r),!Y.checkProPermissions(r))return"function"==typeof e.complete&&e.complete(),void("function"==typeof e.error&&e.error("cannot restart alert with current pro plan",!0));var o=Date.now(),s=r.prepareToSend();return i._generateScriptWithCancellation(r).then((function(t){return s.script=t.IL,t.inputs&&(s.inputs=t.inputs),i.sendRequest({headers:Y.getAnalyticsHeaders(r.get("extra").conditionId(),e.actionSource),method:"restart_alert",params:s,success:function(){i._gaTrackEvent("restart",r),r.set("active",!0),"function"==typeof e.success&&e.success(r)},complete:function(){var t=Date.now()-o;q.sendReport("alerts","full_time_frame",{value:t}),"function"==typeof e.complete&&e.complete(r)},error:e.error})})).catch((function(t){
if(t===V)return N.logNormal("Alert generation is cancelled because next alert generation is started"),V;"function"==typeof e.error&&e.error("Can't generate alert source code for alert #"+n)}))}i.requestAlert(n,{success:function(t){t?i.restartAlert(t,e):("function"==typeof e.error&&e.error("Can't find alert "+n),"function"==typeof e.complete&&e.complete())}})},Y.prototype._generateScriptWithCancellation=function(t){var e=this;null==e._lastGenIds[t.cid]&&(e._lastGenIds[t.cid]=0),e._lastGenIds[t.cid]++;var r=e._lastGenIds[t.cid];return new Promise((function(e,r){var n=t.get("extra"),i=null,o="";if(n.isValid()?null===(i=n.toGenAlertJSON(t.get("description")))&&(o="Can't generate alert JSON"):o="Can't generate alert on invalid AlertExtra",o)return N.logError(o),void r(o);w.generateAlert(JSON.stringify(i)).then((function(t,r,n){e({IL:r,inputs:n})}),r)})).then((function(n){return e._lastGenIds[t.cid]!==r?Promise.reject(V):(t.set("script",n.IL),n)}))},Y.prototype.restartAllAlerts=function(t){var e,r=this,n={crossInterval:!0};(t=t||{}).symbol&&(n.symbol=t.symbol),t.resolution&&(n.resolution=t.resolution),"boolean"==typeof t.active&&(n.active=t.active),t.showConfirm&&(e=t.symbol||t.resolution?$.t("Do you really want to restart filtered alerts?"):$.t("Do you really want to restart all inactive alerts?")),r.alerts.every(Y.checkProPermissions)&&r.sendRequest({method:"restart_all",params:n,success:function(){r._gaTrackEvent("restart_all"),r.alerts.each((function(t){n.symbol&&n.symbol!==t.get("symbol")||n.resolution&&n.resolution!==t.get("resolution")||t.set("active",!0)})),"function"==typeof t.success&&t.success()},error:t.error,complete:t.complete,confirmation:e})},Y.prototype.requestAlert=function(t,e){var r=this,n=(e=e||{},parseInt(t));function i(t){var i=r.alerts.get(n)||null;return(i||t)&&("function"==typeof e.success&&e.success(i),"function"==typeof e.complete&&e.complete()),!!i}function o(){r.sendRequest({method:"get_alert",preventMaintenanceDialog:!0,params:{id:n},success:function(t){var n,i=t.alert;i=R(i),r._alertVersioning.migrate(i).then((function(t){n=new E(t),r.alerts.add(n),"function"==typeof e.success&&e.success(n)})).catch((function(t){"function"==typeof e.error&&e.error(t)}))},complete:e.complete,error:function(r){"function"==typeof e.error?e.error(r):N.logError("Error in getting alert "+t+(r?": "+r:""))}})}!0===e.fromCache?i(!0):!1===e.fromCache?o():i()||o()},Y.prototype.getAlertSync=function(t){return this.alerts.get(t)||null},Y.prototype.ensureFullAlertsList=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=function(t){"function"==typeof e.error&&e.error(t)},n=function(){"function"==typeof e.success&&e.success()},i=function(){"function"==typeof e.complete&&e.complete()};return window.is_authenticated||(this._fullListWasRequested=!0),this._fullListWasRequested?(n(),i(),Promise.resolve()):this.sendRequest({method:"list_alerts",preventMaintenanceDialog:!0,params:{limit:2e3},success:function(e){if(!e.alerts||!Array.isArray(e.alerts)){var i="Not valid params in alert list response"
;return N.logError(i),void r(i)}z(e.alerts,(function(e){return t._alertVersioning.migrate(e)})).then((function(e){t.alerts.set(e),t._fullListWasRequested=!0,n()})).catch(r)},error:e.error,complete:i})},Y.prototype.requestEventList=function(t){var e=this,r={sym:(t=t||{}).symbol,res:t.resolution&&t.resolution.toString?t.resolution.toString():void 0,limit:t.limit,before:t.before,inc_cross_int:void 0===t.includeCrossInterval||t.includeCrossInterval};t.aid&&(r.aid=t.aid),this.sendRequest({method:"list_events",preventMaintenanceDialog:!0,params:r,success:function(r){var n=r.events;n&&$.isArray(n)?(n=$.map(n,(function(t){var r=new A(R(t));return e.events.add(r),r})),"function"==typeof t.success&&t.success(n)):console.warn("[Alerts] Not valid params in event list response")},error:t.error,complete:t.complete})},Y.prototype.deleteEvents=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.ids;if(r&&0===r.length)return n(),void i();function n(){"function"==typeof e.success&&e.success()}function i(){"function"==typeof e.complete&&e.complete()}this.sendRequest({method:"delete_events",params:r?{ids:r}:void 0,success:function(){r?t.events.remove(r):t.events.reset(),n()},error:e.error,complete:e.complete})},Y.prototype.sendRequest=function(t){var e=t.method,r=L(t.params);if(function(t,e){if(["create_alert","restart_alert"].includes(t)){var r=e.extra&&JSON.parse(e.extra),n=r&&r.condition;"strategy"===n.id&&(e.alert_type="strategy"),["strategy","alerts","strategy_and_alerts"].includes(n.id)&&(e.ns_only_fire=!0)}}(e,r),m.alertsMaintenanceTracker.sync(),m.alertsMaintenanceTracker.value())return s("maintenance"),a(),Promise.reject("maintenance");if(t.confirmation){var n=!0;return new Promise((function(e,r){k({content:t.confirmation,title:$.t("Alert"),type:"modal"}).then((function(t){t.actionLoader("yes"),t.on("action:yes",(function(t){t.actionLoader("yes","start");var r=i();r.then((function(e){return t.actionLoader("yes","stop"),t.close(),e})).catch((function(e){return t.actionLoader("yes","stop"),e})),e(r),n=!1})),t.on("action:no",(function(){c(),a(),n=!1})),t.on("afterClose",(function(){n&&(c(),a())})),t.open()}))}))}return i();function i(){var n=C({method:e,params:r,noCache:t.noCache,headers:t.headers});return n.then(o,s),n}function o(e){if("function"==typeof t.success){var r=R(e);t.success(r)}return a(),r}function s(e){var r=!1;return"max_alerts_count_exceeded"===e?(W(),r=!0):"max_total_alerts_count_exceeded"===e?(U(),r=!0):"pro_plan_expired"===e?(j(),r=!0):"maintenance"===e&&(t.preventMaintenanceDialog||(setTimeout(B,0),r=!0)),"function"==typeof t.error?t.error(e,r):"maintenance"===e?N.logNormal("Alerts maintenance"):e&&N.logError("Reason: "+e),a(),e}function a(){"function"==typeof t.complete&&t.complete()}function c(){"function"==typeof t.cancel&&t.cancel()}},Y.prototype.setChartWidgetCollection=function(t){this._chartWidgetCollection=t},Y.prototype.chartWidget=function(){var t=null;return this._chartWidgetCollection&&(t=this._chartWidgetCollection.activeChartWidget.value()||null),t},
Y.prototype._gaTrackEvent=function(t,e,r){var n;P("alert",t,r),"create"===t&&e instanceof E&&(n=e.get("extra"),P("alert","create__style",function(t){var e=t&&t.getMainSeries(),r=e&&e.getStyle&&e.getStyle();return r&&T.STYLE_SHORT_NAMES.hasOwnProperty(r)?T.STYLE_SHORT_NAMES[r]:"unknown"}(n)),P("alert","create__condition",function(t){var e=t.conditionId();return t.prepareAlertConditions()[e]&&(e="pine_condition"),e||"unknown"}(n)),P("alert","create__frequency",e.get("frequency")||"unknown"),e.isPrice()?P("alert","create__on","price"):e.isDrawing()?P("alert","create__on","drawing"):e.isMoving()?P("alert","create__on","moving"):n.band()||n.upperBand()||n.lowerBand()?P("alert","create__on","study"):P("alert","create__on","unknown"))},Y.prototype.getAlertDialogInvocations=function(){return y.alertEditorInvocationHandler.getDialogInvocations()},Y.prototype.openCreateDialog=function(t){S(i({type:"create_alert"},t))},Y.prototype.openEditDialog=function(t,e){var r,n,i=this,o=function(t){return e.onAborted&&e.onAborted(t)};!(e=e||{}).dataSourceHub&&i.chartWidget()&&(e.dataSourceHub=i.chartWidget().model().model()),t instanceof E?r=t:(n=t,r=i.alerts.get(n)),r?(e=$.extend(e,{alert:r,type:"edit_alert"}),S(e)):n?i.requestAlert(n,{success:function(t){i.openEditDialog(t,e)},error:function(t){"not_exists"===t&&(0,a.showNoticeDialog)({type:"modal",title:window.t("Alert"),content:window.t("Alert does not exist.")}),"function"==typeof e.error&&e.error(t),o(b.AlertIsInvalid)}}):(console.error("[Alerts] alert id is required to edit alert"),o(b.AlertIsInvalid))},Y.prototype.subscribeToPushStream=function(t){this._onPushStreamMessage.subscribe(null,t)},Y.prototype.unsubscribeFromPushStream=function(t){t?this._onPushStreamMessage.unsubscribe(null,t):this._onPushStreamMessage.unsubscribeAll(null)},Y.prototype.getAlertNotifier=function(){if(null===this._notifierPromise){var t=this;this._notifierPromise=M().then((function(e){return e.onEditAlert.subscribe(null,(function(e,r,n){r===d.AlertCategory.Price&&t.openEditDialog(e,i({},n,{actionSource:"alert_notifier_edit"}))})),e.onRestartAlert.subscribe(null,(function(e,r,n){r===d.AlertCategory.Price&&t.restartAlert(e,i({},n,{actionSource:"alert_notifier_restart"}))})),e}))}return this._notifierPromise},t.exports.AlertsDispatcher=Y}).call(this,r("q1z7"))},"4BMm":function(t,e){var r={active:"active",aid:"alertId",alerts:"alerts",bar_time:"barTime",create_t:"createTime",cross_int:"crossInterval",deact:"autoDeactivation",desc:"description",email:"sendEmail",error:"error",events:"events",exp:"expired",fire_time:"fireTime",inc_cross_int:"includeCrossInterval",inf_exp:"noExpiration",internal_sym:"symbolInternal",popup:"showPopup",reason:"reason",res:"resolution",script_deps:"scriptDeps",script:"script",sms:"sendSms",true_sms:"sendTrueSms",snd:"playSound",push:"sendPush",snd_duration:"soundDuration",snd_file:"soundFile",sort_by:"sortBy",sort_dir:"sortDirection",start_t:"startTime",stop_t:"stopTime",stop:"stopReason",sym:"symbol",web_hook:"webhookUrl",inst_id:"instanceId",name:"name"},n=function(){var t={}
;return Object.keys(r).forEach((function(e){t[r[e]]=e})),t}();function i(t,e){var r={};return t?(Object.keys(t).forEach((function(n){var i=e(n),o=t[n];r[i]=o})),r):t}e.server2clientParams=function(t){return i(t,(function(t){return r[t]||t}))},e.client2serverParams=function(t){return i(t,(function(t){return n[t]||t}))}},Evi4:function(t,e,r){"use strict";var n=r("C2JW").AlertExtra,i=r("0YCj"),o=r("K4L1"),s=r("cBZt").extractStudyId,a=r("TcSq").extractPineId,c=r("xD5v").prepareCallStudyArgs,l=r("e3/o"),u=r("txPx").getLogger("Alerts.Versioning"),d=r("nmnj"),f=r("nXyu"),p=r("YJLw"),h=r("dn9U"),_=r("n5al"),v=r("PjMa").DataSourceDangerReason,m=r("uXxt").AlertExtraUpdateScheduler,y=r("+GxX").isFeatureEnabled;function g(){this._extraUpdateScheduler=new m}g.version_10_tv_6611_1a_refactoring=10,g.version_11_tv_6611_1b_refactoring=11,g.version_12_tv_6888_fix_plot_index=12,g.version_13_tv_4164_source_code_protection=13,g.version_14_tv_4164_source_code_protection_fix=14,g.version_15_tv_8068_fix_main_series_resolution=15,g.version_16_jv_298_remove_callstudy=16,g.version_17_jv_646_fix_mixed_inputs=17,g.version_18_tv_10636_price_format=18,g.version_19_tv_11267_fix_frequency_options=19,g.version_20_tv_14463_extract_dividends_adjustment_from_symbol_string=20,g.version_21_tv_14886_add_alert_dangerous_source_check=21,g.prototype.migrate=function(t,e){var r;if(e=Object.assign({sendExtraUpdate:y("alerts-send-extra-update")},e),!t||!t.extra)return Promise.resolve(t);if((r=JSON.parse(t.extra))&&!Object.keys(r).length&&r.constructor===Object)return delete t.extra,Promise.resolve(t);var i=Promise.resolve(t),o=null==r.version||r.version<n.VERSION;return o&&(i=this._patchAlert(r,t)),i=i.then(function(t){var r=JSON.parse(t.extra);return r.version<n.VERSION?u.logError("Alert version is less than current"):r.version>n.VERSION?u.logNormal("Alert version is greater than current"):o&&e.sendExtraUpdate&&this._extraUpdateScheduler.scheduleUpdate({id:t.id,instanceId:t.instanceId,extra:t.extra}),t}.bind(this))},g.prototype._patchAlert=function(t,e){var r=this;t.version||(t.version=1);var n=t.version;n<g.version_10_tv_6611_1a_refactoring&&(t.condition.mainSeries=this._patchBand_to10(t.condition.mainSeries,e.symbol),t.condition.options.band&&(t.condition.options.band=this._patchBand_to10(t.condition.options.band,e.symbol)),t.condition.options.upperBand&&(t.condition.options.upperBand=this._patchBand_to10(t.condition.options.upperBand,e.symbol)),t.condition.options.lowerBand&&(t.condition.options.lowerBand=this._patchBand_to10(t.condition.options.lowerBand,e.symbol)),t.version=g.version_10_tv_6611_1a_refactoring),n<g.version_11_tv_6611_1b_refactoring&&(t=this._patchExtra_to11(t)),n<g.version_12_tv_6888_fix_plot_index&&(t=this._patchExtra_to12(t)),n<g.version_13_tv_4164_source_code_protection&&(t=this._patchExtra_to13(t,e)),n<g.version_14_tv_4164_source_code_protection_fix&&(t=this._patchExtra_to14(t,e)),n<g.version_15_tv_8068_fix_main_series_resolution&&(t=this._patchExtra_to15(t,e)),e.extra=JSON.stringify(t);var i=Promise.resolve(e)
;return n<g.version_16_jv_298_remove_callstudy&&(i=i.then((function(t){return r._patchAlert_to16(t)}))),n<g.version_17_jv_646_fix_mixed_inputs&&(i=i.then((function(t){var e=JSON.parse(t.extra),n=r._patchExtra_to17(e);return t.extra=JSON.stringify(n),t}))),n<g.version_18_tv_10636_price_format&&(i=i.then((function(t){var e=JSON.parse(t.extra),n=r._patchExtra_to18(e);return t.extra=JSON.stringify(n),t}))),n<g.version_19_tv_11267_fix_frequency_options&&(i=i.then((function(t){return r._patchAlert_to19(t)}))),n<g.version_20_tv_14463_extract_dividends_adjustment_from_symbol_string&&(i=i.then((function(t){var e=JSON.parse(t.extra),n=r._patchExtra_to20(e);return t.extra=JSON.stringify(n),t}))),n<g.version_21_tv_14886_add_alert_dangerous_source_check&&(i=i.then((function(t){var e=JSON.parse(t.extra),n=r._patchExtra_to21(e);return t.extra=JSON.stringify(n),t}))),i},g.prototype.cancelPossibleExtraUpdate=function(t){this._extraUpdateScheduler.cancelUpdate(t)},g.prototype.cancelAllPossibleExtraUpdates=function(){this._extraUpdateScheduler.cancelAllUpdates()},g.prototype._patchBand_to10=function(t,e){return t=this._patchBand_to10_callStudyArgs(t),t=this._patchBand_to10_stateForAlert(t,e)},g.prototype._patchBand_to10_callStudyArgs=function(t){var e=t&&"Study"===t.type,r=e&&(t.alertsData||{}).callStudyArgs,n=e&&t.metaInfo&&t.state&&t.state.inputs;return e&&!r&&n?(t.alertsData||(t.alertsData={}),t.alertsData.callStudyArgs=c(t.state.inputs,t.metaInfo),t):t},g.prototype._patchBand_to10_stateForAlert=function(t,e){var r,n;if(!t)return t;if(n=!t.state,"MainSeries"!==(r=t.type)||n){if("Study"!==r&&!/^study_\w+/.test(r)||n)return t;var i=t.metaInfo.plots.map((function(e){var r={id:e.id,type:e.type,offset:t.data.completePlotOffsets[e.id]};return t.metaInfo.styles&&void 0!==t.metaInfo.styles[e.id]&&(r.title=t.metaInfo.styles[e.id].title||""),e.target&&t.metaInfo.ohlcPlots&&t.metaInfo.ohlcPlots[e.target]&&(r.ohlcTitle=t.metaInfo.ohlcPlots[e.target].title),r}));return{id:t.id,uniqueId:t.uniqueId,type:t.type,title:"",shortDescription:t.state.shortDescription||"Study",fullId:t.metaInfo.fullId,isTVScript:!!t.metaInfo.isTVScript,plots:i,inputs:t.state.inputs,alerts:t.metaInfo.alerts,callStudyArgs:t.alertsData.callStudyArgs,plotIndex:t.plotIndex,plotOffset:t.plotOffset}}return{id:t.id,uniqueId:t.uniqueId,type:t.type,proSymbol:t.state.symbol||e,actualSymbol:e,interval:t.state.interval,style:t.state.style,styleInputs:function(){var e={0:"bar",1:"candle",2:"line",3:"area",4:"renko",5:"kagi",6:"pnf",7:"pb",8:"ha",9:"hollowCandle"}[t.state.style];if(e){var r=t.state[e+"Style"];if(r)return r.inputs}}(),extendedHours:t.state.extendedHours,boxSize:t.boxSize,reversalAmount:t.reversalAmount}},g.prototype._patchExtra_to11=function(t){var e=function(t,e,r){r.id=r.id||l.randomHashN(6),t.condition[e]={id:r.id,plotIndex:r.plotIndex},t.statesForAlert[r.id]=r},r={version:g.version_11_tv_6611_1b_refactoring,condition:{id:t.condition.id,fireInfo:{frequency:t.frequency||"once"},movPeriod:t.condition.options.period,movValue:t.condition.options.value},statesForAlert:{}}
;e(r,"alertSeries",t.condition.mainSeries);return["band","upperBand","lowerBand"].filter((function(e){return!!t.condition.options[e]})).forEach((function(n){e(r,n,t.condition.options[n])})),r},g.prototype._patchExtra_to12=function(t){return["alertSeries","band","upperBand","lowerBand"].filter((function(e){return!!t.condition[e]&&void 0!==t.condition[e].plotIndex})).map((function(e){var r=t.condition[e];return{state:t.statesForAlert[r.id],plotIndex:r.plotIndex}})).filter((function(t){return!!t.state.plots})).forEach((function(t){var e=t.state.plots[t.plotIndex];null==e||"object"!=typeof e&&"function"!=typeof e||void 0===e.pinePlotIndex&&(e.pinePlotIndex=t.plotIndex)})),t.version=g.version_12_tv_6888_fix_plot_index,t},g.prototype._patchExtra_to13=function(t,e){var r=t;if(!t.condition.mainSeries){if("MainSeries"===t.statesForAlert[t.condition.alertSeries.id].type)r.condition.mainSeries=r.condition.alertSeries;else{var n=l.randomHashN(6);r.condition.mainSeries={id:n},r.statesForAlert[n]={id:n}}r.statesForAlert[r.condition.mainSeries.id].symbolString=e.symbol}for(var o in t.statesForAlert){var s=t.statesForAlert[o];s.fullId&&(s.scriptIdPart=i.parseIdString(s.fullId).shortId.split("$")[1])}return r.version=g.version_13_tv_4164_source_code_protection,r},g.prototype._patchExtra_to14=function(t,e){var r=t;return t.condition.mainSeries||("MainSeries"===t.statesForAlert[t.condition.alertSeries.id].type?r.condition.mainSeries=r.condition.alertSeries:(r.condition.mainSeries={id:l.randomHashN(6)},r.statesForAlert[r.condition.mainSeries.id]={})),null==r.statesForAlert[r.condition.mainSeries.id].symbolString&&(r.statesForAlert[r.condition.mainSeries.id].symbolString=e.symbol),r.version=g.version_14_tv_4164_source_code_protection_fix,r},g.prototype._patchExtra_to15=function(t,e){var r=t;return null==r.statesForAlert[r.condition.mainSeries.id].interval&&(r.statesForAlert[r.condition.mainSeries.id].interval=e.resolution),r.version=g.version_15_tv_8068_fix_main_series_resolution,r},g.prototype._patchAlert_to16=function(t){var e=JSON.parse(t.extra);function r(t){return t.replace(/tv-scripting-1!?$/,"tv-scripting-88")}function n(e){return(n=e,o=i.cutDollarHash(n.fullId),a=g._recoverFullInputs(n.fullId,n.pineId,n.pineVersion,n.inputs).then((function(t){return{id:f.idForAlert(s(n.fullId),t),study:r(o),inputs:t}})),c=new Promise((function(t,e){var i=JSON.parse(n.callStudyDependencies||"[]").map((function(t){return g._recoverFullInputs(null,t.scriptIdPart,t.scriptVersion,t.inputs).then((function(e){return{id:t.id,study:r(t.study),inputs:e}}))}));Promise.all(i).then((function(e){t(e)}),e)})),a.then((function(t){return c.then((function(e){return[t].concat(e)}))}))).then((function(r){e.studyDependencies=r;var n=r[0];e.id=n.id,e.uniqueId=e.id,t.scriptDeps=t.scriptDeps.concat(r)}));var n,o,a,c}t.scriptDeps=[];var o=[];for(var a in e.statesForAlert)if(e.statesForAlert.hasOwnProperty(a)){var c=e.statesForAlert[a];if("MainSeries"===c.type)c.id=p(c.symbolString+c.interval).toString(),
c.uniqueId=c.id;else if(/^LineTool.*/i.test(c.type))c.id=c.uniqueId;else if("Study"===c.type||/^study_\w+/.test(c.type)){var l=n(c);o.push(l)}}return Promise.all(o).then((function(){return function(t){var e={},r={};Object.keys(t.statesForAlert).forEach((function(n){var i=t.statesForAlert[n].id;e[n]=i,r[i]=t.statesForAlert[n]})),Object.keys(t.condition).filter((function(r){return null!=t.condition[r].id&&null!=e[t.condition[r].id]})).forEach((function(r){t.condition[r].id=e[t.condition[r].id]})),t.statesForAlert=r}(e),e.version=g.version_16_jv_298_remove_callstudy,t.extra=JSON.stringify(e),t}))},g.prototype.patchAlert_to16_forTestsOnly=g.prototype._patchAlert_to16,g.prototype._patchExtra_to17=function(t){for(var e in t.statesForAlert)if(t.statesForAlert.hasOwnProperty(e)){var r=t.statesForAlert[e],n=r.inputs;if(null!=n&&(r.inputs=o.splitInputs(n).obj),null!=r.studyDependencies)for(var i=0;i<r.studyDependencies.length;i++){var s=r.studyDependencies[i];s.inputs=o.splitInputs(s.inputs).obj}}return t.version=g.version_17_jv_646_fix_mixed_inputs,t},g.prototype.patchExtra_to17_forTestsOnly=g.prototype._patchExtra_to17,g._recoverFullInputs=function(t,e,r,n){if(e=e||t&&a(t)||n.pineId,r=r||n.pineVersion||"-1",null==e)return Promise.resolve(n);var i=d.translateScriptAsync2(e,r);return new Promise((function(t,e){i.then(t,e)})).catch((function(t){if("-1"===r&&e.startsWith("USER")){var i=function(t){var e={};return Object.keys(t).forEach((function(r){var n,i=t[r];r.startsWith("in_")?(n=["open","high","low","close","hl2","hlc3","ohlc4"].indexOf(i)>0||/.*\$\d+/.test(i)?"source":"string"==typeof i?"string":"boolean"==typeof i?"bool":"float",e[r]={f:!0,v:i,t:n}):e[r]=i})),e}(n);return u.logNormal("A very rare case: alert on legacy script that was never resaved. Trying to guess input types \n\t"+JSON.stringify(n)+" -> "+JSON.stringify(i)),i}return u.logError("Alert migration failed, inputs cannot be migrated: "+JSON.stringify(t)),Promise.reject(t)})).then((function(t){return TVScript.patchInputs(t.inputs,n)}))},g.prototype._patchExtra_to18=function(t){var e,r={},n=h.getData(t.condition.id);if(n&&"comparison"===n.type)if(n.isChannel){var i=t.statesForAlert[t.condition.upperBand.id],o=t.statesForAlert[t.condition.lowerBand.id];"Value"===i.type?e=i.value:"Value"===o.type&&(e=o.value)}else{var s=t.statesForAlert[t.condition.band.id];"Value"===s.type&&(e=s.value)}if(e&&-1!==(e=e.toString().replace(/^-/,"")).indexOf(".")){var a=e.replace(/^\d+\./,"").length,c=Math.pow(10,a);r.priceScale=c}var l=t.condition.alertSeries.id;return t.statesForAlert[l].formatter={type:"price",state:r},t.version=g.version_18_tv_10636_price_format,t},g.prototype._patchAlert_to19=function(t){var e=JSON.parse(t.extra),r=t.autoDeactivation,n=e.condition.fireInfo.frequency,i=e.statesForAlert[e.condition.mainSeries.id],o=["band","lowerBand","upperBand"].map((function(t){var r=e.condition[t];return r&&e.statesForAlert[r.id]})).filter((function(t){return!!t})).filter((function(t){return"LineToolVertLine"===t.type
})).length>0,s=_.hasProjection(i.style),a=t.crossInterval,c=[];function l(t){return-1!==c.indexOf(t)}return o?c.push("once"):(a||s||(c.push("once"),c.push("60"),c.push("on_bar_close")),s?c.push("on_bar_close"):c.push("on_first_fire")),"once_per_bar"===n&&(n="on_first_fire"),"once"!==n||l("once")||(r=!0,n=c[0]),"once"!==n&&r&&(n=c[0]),"once"!==n&&o&&(r=!0,n="once"),"on_bar_close"===n&&!l("on_bar_close")&&l("on_first_fire")&&(n="on_first_fire"),t.autoDeactivation=r,e.condition.fireInfo.frequency=n,e.version=g.version_19_tv_11267_fix_frequency_options,t.extra=JSON.stringify(e),t},g.prototype._patchExtra_to20=function(t){var e=t.condition.mainSeries,r=t.statesForAlert,n=e&&r&&r[e.id];if(n){var i=n.symbolString;if(i&&0===i.indexOf("=")){var o=i.slice(1);"dividends"===(o=JSON.parse(o)).adjustment?n.dividendsAdjustment=!0:"splits"===o.adjustment&&(n.dividendsAdjustment=!1)}}return t.version=g.version_20_tv_14463_extract_dividends_adjustment_from_symbol_string,t},g.prototype.patchExtra_to20_forTestsOnly=g.prototype._patchExtra_to20,g.prototype._patchExtra_to21=function(t){var e=t.statesForAlert;for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];n.isSpread&&(n.dangerReason=v.Spread)}return t.version=g.version_21_tv_14886_add_alert_dangerous_source_check,t},t.exports={AlertVersioning:g}},JZcM:function(t,e,r){"use strict";var n;r.d(e,"a",(function(){return n})),function(t){t.Fired="fired",t.FireControl="fire_control"}(n||(n={}))},LxhU:function(t,e,r){"use strict";r.r(e),r.d(e,"ResolutionKind",(function(){return n})),r.d(e,"SpecialResolutionKind",(function(){return i})),r.d(e,"Interval",(function(){return u})),r.d(e,"isHour",(function(){return f}));var n,i,o=/^(\d*)([TSHDWMR])$/,s=/^(\d+)$/;!function(t){t.Ticks="ticks",t.Seconds="seconds",t.Minutes="minutes",t.Days="days",t.Weeks="weeks",t.Months="months",t.Range="range",t.Invalid="invalid"}(n||(n={})),function(t){t.Hours="hours"}(i||(i={}));var a={};a[n.Ticks]=1e3,a[n.Seconds]=1e3,a[n.Minutes]=60*a[n.Seconds],a[n.Days]=1440*a[n.Minutes],a[n.Weeks]=7*a[n.Days];var c={T:n.Ticks,S:n.Seconds,D:n.Days,W:n.Weeks,M:n.Months,R:n.Range},l=new Set([n.Ticks,n.Seconds,n.Minutes]),u=function(){function t(t,e){this._kind=n.Invalid,this._multiplier=0,t!==n.Invalid&&e>0&&(this._kind=t,this._multiplier=e)}return t.prototype.kind=function(){return this._kind},t.prototype.multiplier=function(){return this._multiplier},t.prototype.isValid=function(){return this.kind()!==n.Invalid&&this.multiplier()>0},t.prototype.isDWM=function(){return this.isValid()&&!this.isRange()&&!this.isIntraday()&&!this.isTicks()},t.prototype.isIntraday=function(){var t=l.has(this.kind());return this.isValid()&&t},t.prototype.isSeconds=function(){return this.kind()===n.Seconds},t.prototype.isMinutes=function(){return this.kind()===n.Minutes},t.prototype.isMinuteHours=function(){return this.kind()===n.Minutes&&f(this.multiplier())},t.prototype.isDays=function(){return this.kind()===n.Days},t.prototype.isWeeks=function(){return this.kind()===n.Weeks},t.prototype.isMonths=function(){return this.kind()===n.Months},
t.prototype.isRange=function(){return this.kind()===n.Range},t.prototype.isTicks=function(){return this.kind()===n.Ticks},t.prototype.isTimeBased=function(){return!this.isRange()},t.prototype.letter=function(){return this.isValid()&&this.kind()!==n.Minutes?this.kind()[0].toUpperCase():""},t.prototype.value=function(){return this.isValid()?this.kind()===n.Minutes?this.multiplier()+"":this.multiplier()+this.letter():""},t.prototype.isEqualTo=function(e){if(!(e instanceof t))throw new Error("Argument is not an Interval");return!(!this.isValid()||!e.isValid())&&(this.kind()===e.kind()&&this.multiplier()===e.multiplier())},t.prototype.inMilliseconds=function(t){if(void 0===t&&(t=Date.now()),!this.isValid()||this.isRange())return NaN;if(this.isMonths()){var e=new Date(t);return e.setUTCMonth(e.getUTCMonth()+(this.multiplier()||1)),+e-t}var r=this.multiplier();return a[this.kind()]*r},t.isEqual=function(e,r){return t.parse(e).isEqualTo(t.parse(r))},t.parse=function(e){e=(e+"").toUpperCase().split(",")[0];var r=o.exec(e);return null!==r?"H"===r[2]?new t(n.Minutes,60*d(r[1])):new t(c[r[2]],d(r[1])):null!==(r=s.exec(e))?new t(n.Minutes,d(r[1])):new t(n.Invalid,0)},t.kind=function(e){return t.parse(e).kind()},t.isValid=function(e){return t.parse(e).isValid()},t.isDWM=function(e){return t.parse(e).isDWM()},t.isIntraday=function(e){return t.parse(e).isIntraday()},t.isSeconds=function(e){return t.parse(e).isSeconds()},t.isMinutes=function(e){return t.parse(e).isMinutes()},t.isMinuteHours=function(e){return t.parse(e).isMinuteHours()},t.isDays=function(e){return t.parse(e).isDays()},t.isWeeks=function(e){return t.parse(e).isWeeks()},t.isMonths=function(e){return t.parse(e).isMonths()},t.isRange=function(e){return t.parse(e).isRange()},t.isTicks=function(e){return t.parse(e).isTicks()},t.isTimeBased=function(e){return t.parse(e).isTimeBased()},t.normalize=function(e){var r=t.parse(e);return r.isValid()?r.value():null},t}();function d(t){return 0===t.length?1:parseInt(t,10)}function f(t){return t>=60&&!(t%60)}},Zdjc:function(t,e,r){"use strict";r.r(e),r.d(e,"createGoProAlertsTrueSmsDialog",(function(){return i})),r.d(e,"showGoProAlertsTrueSmsDialog",(function(){return o}));r("YFKU");var n=r("oOPW");function i(){return Object(n.createGoProDialog)({feature:"alertsTrueSms",goOnMarkets:!1,isTrialAvailable:!0,upgradeMessage:window.t("Upgrade now"),visitPaymentPage:{product_name:"pro_premium",billing_cycle:"y",options:{newWindow:!0}}})}function o(){i()}},brCa:function(t,e,r){"use strict";r.r(e),r.d(e,"createNoticeDialog",(function(){return o})),r.d(e,"showNoticeDialog",(function(){return s}));var n=r("mrSG"),i=(r("YFKU"),{width:400,destroyOnClose:!0,title:window.t("Notification"),content:window.t("You are notified"),contentWrapTemplate:'<div class="tv-dialog__section tv-dialog__section--no-border"><div class="tv-text"><p></p></div></div>',actionsWrapTemplate:'<div class="tv-dialog__section tv-dialog__section--actions tv-dialog__section--no-border">',actions:[{name:"ok",type:"primary",text:window.t("Ok"),method:"close",key:[13,32]}]})
;function o(t){return new Promise((function(e){Promise.all([r.e("vendors"),r.e("dialogs-core"),r.e(11),r.e(18),r.e(26),r.e(30),r.e(36),r.e(35),r.e(34),r.e("create-dialog")]).then(function(o){var s=r("YDhE").createDialog;e(s(Object(n.a)(Object(n.a)({},i),t)))}.bind(null,r)).catch(void 0)}))}function s(t){o(t).then((function(t){return t.open()}))}},dfhE:function(t,e,r){"use strict";var n,i,o;r.r(e),r.d(e,"STATUS_OFFLINE",(function(){return s})),r.d(e,"STATUS_RESOLVING",(function(){return a})),r.d(e,"STATUS_LOADING",(function(){return c})),r.d(e,"STATUS_READY",(function(){return l})),r.d(e,"STATUS_INVALID_SYMBOL",(function(){return u})),r.d(e,"STATUS_SNAPSHOT",(function(){return d})),r.d(e,"STATUS_EOD",(function(){return f})),r.d(e,"STATUS_PULSE",(function(){return p})),r.d(e,"STATUS_DELAYED",(function(){return h})),r.d(e,"STATUS_DELAYED_STREAMING",(function(){return _})),r.d(e,"STATUS_NO_BARS",(function(){return v})),r.d(e,"STATUS_REPLAY",(function(){return m})),r.d(e,"SERIES_STATUS_TEXT",(function(){return y})),r.d(e,"STYLE_LINE_TYPE_MARKERS",(function(){return g})),r.d(e,"STYLE_LINE_TYPE_STEP",(function(){return S})),r.d(e,"STYLE_LINE_TYPE_SIMPLE",(function(){return b})),r.d(e,"STYLE_BARS",(function(){return A})),r.d(e,"STYLE_CANDLES",(function(){return x})),r.d(e,"STYLE_LINE",(function(){return E})),r.d(e,"STYLE_AREA",(function(){return w})),r.d(e,"STYLE_RENKO",(function(){return T})),r.d(e,"STYLE_KAGI",(function(){return I})),r.d(e,"STYLE_PNF",(function(){return P})),r.d(e,"STYLE_PB",(function(){return D})),r.d(e,"STYLE_HEIKEN_ASHI",(function(){return O})),r.d(e,"STYLE_HOLLOW_CANDLES",(function(){return k})),r.d(e,"STYLE_BASELINE",(function(){return N})),r.d(e,"STYLE_RANGE",(function(){return C})),r.d(e,"STYLE_HILO",(function(){return M})),r.d(e,"STYLE_SHORT_NAMES",(function(){return R})),r.d(e,"SYMBOL_STRING_DATA",(function(){return L}));var s=0,a=1,c=2,l=3,u=4,d=5,f=6,p=7,h=8,_=9,v=10,m=11,y=((n={})[s]="connecting",n[a]="loading",n[c]="loading",n[l]="realtime",n[u]="invalid",n[d]="snapshot",n[f]="endofday",n[p]="endofday",n[h]="delayed",n[_]="delayed_streaming",n[v]="forbidden",n[m]="replay",n),g=0,S=1,b=2,A=0,x=1,E=2,w=3,T=4,I=5,P=6,D=7,O=8,k=9,N=10,C=11,M=12,R=((i={})[0]="bar",i[1]="candle",i[9]="hollowCandle",i[2]="line",i[3]="area",i[4]="renko",i[7]="pb",i[5]="kagi",i[6]="pnf",i[8]="ha",i[10]="baseline",i[11]="range",i[12]="hilo",i),L=((o={})[4]={type:"BarSetRenko@tv-prostudies",basicStudyVersion:40},o[7]={type:"BarSetPriceBreak@tv-prostudies",basicStudyVersion:34},o[5]={type:"BarSetKagi@tv-prostudies",basicStudyVersion:34},o[6]={type:"BarSetPnF@tv-prostudies",basicStudyVersion:34},o[8]={type:"BarSetHeikenAshi@tv-basicstudies",basicStudyVersion:60},o[11]={type:"BarSetRange@tv-basicstudies",basicStudyVersion:72},o)},flg1:function(t,e,r){"use strict";r.r(e),r.d(e,"showAlertsMaintenanceDialog",(function(){return o}));var n=r("1UCy"),i=r("PlME");function o(){Object(i.showAbortExplainingDialog)(n.AlertEditorAbortReason.AlertsMaintenance)}},gdgp:function(t,e,r){"use strict";r.r(e),
r.d(e,"showGoProMaxAlertsDialog",(function(){return i}));var n=r("oOPW");function i(){Object(n.createGoProDialog)({feature:"alerts"})}},ijto:function(t,e,r){"use strict";function n(t){return Promise.all(t.map((function(t){return t.then((function(t){return{status:"fulfilled",value:t}})).catch((function(t){return{status:"rejected",reason:t}}))})))}r.r(e),r.d(e,"allSettled",(function(){return n}))},jA5l:function(t,e,r){"use strict";r.r(e),r.d(e,"showGoProAlertsWebhookDialog",(function(){return i}));var n=r("oOPW");function i(){Object(n.createGoProDialog)({feature:"alertsWebhook"})}},oNDq:function(t,e,r){"use strict";r.r(e),r.d(e,"createConfirmDialog",(function(){return o}));var n=r("mrSG"),i=r("YFKU");function o(t){var e={actions:[{key:13,name:"yes",text:i.t("Yes"),type:"success"},{method:"close",name:"no",text:i.t("No"),type:"default"}],actionsWrapTemplate:'<div class="tv-dialog__section tv-dialog__section--actions tv-dialog__section--no-border">',content:i.t("Are you sure?"),contentWrapTemplate:'<div class="tv-dialog__section tv-dialog__section--no-border"><div class="tv-text"><p></p></div></div>',destroyOnClose:!0,title:i.t("Confirmation"),width:400,dataset:{"dialog-type":"confirm-dialog"}};return new Promise((function(i){Promise.all([r.e("vendors"),r.e("dialogs-core"),r.e(11),r.e(18),r.e(26),r.e(30),r.e(36),r.e(35),r.e(34),r.e("create-dialog")]).then(function(o){var s=r("YDhE").createDialog;i(s(Object(n.a)(Object(n.a)({},e),t)))}.bind(null,r)).catch(void 0)}))}},oOPW:function(t,e,r){"use strict";r.r(e),r.d(e,"createGoProDialog",(function(){return i}));var n=r("mrSG");r("bSeV");function i(t){var e;return Object(n.b)(this,void 0,void 0,(function(){var i;return Object(n.d)(this,(function(n){switch(n.label){case 0:return[4,Promise.all([r.e("vendors"),r.e(0),r.e(1),r.e(2),r.e(3),r.e(5),r.e(9),r.e(20),r.e(522),r.e(4),r.e(15),r.e(28),r.e("conversion"),r.e(275),r.e("gopro-dialog")]).then(r.bind(null,"aZey"))];case 1:return i=n.sent(),[4,null===(e=window.pro)||void 0===e?void 0:e.ensureValidShopConf()];case 2:return n.sent(),i.renderGoproDialog(t),[2]}}))}))}window.TradingView.createGoProDialog=i},sg6D:function(t,e,r){"use strict";var n=r("/ELx").extend({_prepareToSet_fireTime:function(t){return new Date(1e3*t)},_prepareToSet_barTime:function(t){return new Date(1e3*t)},_prepareToSet_alertId:function(t){return parseInt(t)},fireTimeReadable:function(){return this._formatDate(this.get("fireTime"))},fireTimeUnix:function(){return Math.round(this.get("fireTime").getTime()/1e3)}});t.exports=n},"tc+8":function(t,e,r){"use strict";(function(e){var n=r("ogJP").isFunction;function i(t){if(this._listeners=new e,this._childs=[],this._muteChildChanges=!1,void 0!==t)if(this.isPrimitiveType(t))this._value=t;else for(var r in t)this.addProperty(r,t[r])}i.prototype.merge=function(t,e){var r=null;if(e)var n=(r=[]).length;if(null==t)return r;if(this.isPrimitiveType(t))return e&&this._value!==t&&r.push(this),this._value=t,r;if(Array.isArray(t))for(var i=0;i<t.length;i++)if(this[i]){var o=this[i].merge(t[i],e);e&&(r=r.concat(o))
}else this.addProperty(i,t[i]),e&&r.push(this[i]);else for(var s in t)if(this[s]){o=this[s].merge(t[s],e);e&&void 0!==o&&(r=r.concat(o))}else this.addProperty(s,t[s]),e&&r.push(this[s]);return e&&r.length>n&&r.push(this),r},i.prototype.mergeAndFire=function(t){var e=this.merge(t,!0);this._muteChildChanges=!0,e.forEach((function(t){t._muteChildChanges=!0})),e.forEach((function(t){t._muteChildChanges=!1,t.listeners().fire(t)})),this._muteChildChanges=!1,e.length>0&&this.listeners().fire(this)},i.prototype.state=function(t){var e=n(this.value)?this.value():void 0;void 0===e&&(e={});for(var r=0;r<this._childs.length;r++){var i=this._childs[r];if(!t||-1===t.indexOf(i))if(t){for(var o=[],s=0;s<t.length;s++){var a=t[s];a.startsWith(i+".")&&o.push(a.substr(i.length+1))}e[i]=this[i].state(o)}else e[i]=this[i].state()}return e},i.prototype.clone=function(t){return new i(this.state())},i.prototype.isPrimitiveType=function(t){return null===t||(!!isNumber(t)||(!!new TradingView.TypeValidator(String).check(t)||TradingView.isBoolean(t)))},i.prototype.value=function(){return this._value},i.prototype.listeners=function(){return this._listeners},i.prototype.childCount=function(){return this._childs.length},i.prototype.childNames=function(){return this._childs},i.prototype.child=function(t){return this[t]},i.prototype.setValue=function(t,e){(this._value!==t||e)&&(this._value=t,this._listeners.fire(this))},i.prototype.setValueSilently=function(t){this._value=t},i.prototype.addProperty=function(t,e){var r=new i(e);this[t]=r,this._childs.push(t),r.subscribe(this,this.childChanged)},i.prototype.removeProperty=function(t){this[t].unsubscribe(this,this.childChanged),delete this[t],this._childs=this._childs.filter((function(e){return e!==t}))},i.prototype.hasChild=function(t){return this._childs.indexOf(t)>=0},i.prototype.addChild=function(t,e){this[t]&&this[t].unsubscribe(this,this.childChanged),this[t]=e,-1===this._childs.indexOf(t)&&this._childs.push(t),e.subscribe(this,this.childChanged)},i.prototype.childChanged=function(t,e){this._muteChildChanges||this.listeners().fire(this)},i.prototype.subscribe=function(t,e){this.listeners().subscribe(t,e,!1)},i.prototype.unsubscribe=function(t,e){this.listeners().unsubscribe(t,e)},i.prototype.unsubscribeAll=function(t){this.listeners().unsubscribeAll(t)},i.prototype.childs=function(){return this},t.exports=i}).call(this,r("aIyQ"))},uOo4:function(t,e,r){"use strict";function n(t){return!t.isDrawing()}r.r(e),r.d(e,"isAlertCloneable",(function(){return n}))},uXxt:function(t,e,r){"use strict";r.r(e),r.d(e,"AlertExtraUpdateScheduler",(function(){return l}));var n=r("mrSG"),i=r("hWRP"),o=r("4BMm"),s=r("txPx"),a=Object(s.getLogger)("Alerts.ExtraUpdateScheduler"),c=clearTimeout,l=function(){function t(){this._queue=new Map,this._taskHandle=null}return t.prototype.scheduleUpdate=function(t){this._queue.set(t.id,t),this._maybeScheduleTask()},t.prototype.cancelUpdate=function(t){this._queue.delete(t),null!==this._taskHandle&&0===this._queue.size&&(c(this._taskHandle),this._taskHandle=null)},
t.prototype.cancelAllUpdates=function(){this._queue.clear(),null!==this._taskHandle&&(c(this._taskHandle),this._taskHandle=null)},t.prototype._maybeScheduleTask=function(){var t=this;null===this._taskHandle&&0!==this._queue.size&&(this._taskHandle=setTimeout((function(){return Object(n.b)(t,void 0,void 0,(function(){var t;return Object(n.d)(this,(function(e){switch(e.label){case 0:return(t=this._queue.values().next().value)?(this._queue.delete(t.id),[4,u(t)]):[3,2];case 1:e.sent(),e.label=2;case 2:return this._taskHandle=null,this._maybeScheduleTask(),[2]}}))}))}),1e3))},t}();function u(t){return a.logDebug("Sending extra update request for alert "+t.id),Object(i.sendRequest)({method:"update_extra",params:Object(o.client2serverParams)(t)}).then((function(){return a.logDebug("Extra has been updated successfully for alert "+t.id)}),(function(e){return a.logWarn("Could not update extra for alert "+t.id+": "+e)}))}},zL88:function(t,e,r){"use strict";function n(){Promise.all([r.e("vendors"),r.e(1),r.e(2),r.e(9),r.e(20),r.e(22),r.e(27),r.e(267),r.e(222),r.e("show-warning-alerts-max-total-count-exceeded")]).then(r.bind(null,"MR9f")).then((function(t){return t.showWarningAlertsMaxTotalCountExceededImpl()}))}r.r(e),r.d(e,"showWarningAlertsMaxTotalCountExceeded",(function(){return n}))},zNIe:function(t,e,r){"use strict";function n(t){return t.includes(":")?t.split(":")[1]:t}function i(t){var e=new URL("chart",window.location.origin);return e.searchParams.append("symbol",t),e.toString()}r.d(e,"b",(function(){return n})),r.d(e,"a",(function(){return i}))}}]);